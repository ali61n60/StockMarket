try{var _peSd={config:{domain:'pushengage.com',staticStorageUrl:'https://assetscdn.pushengage.com',},site:{sI:'https://assetscdn.pushengage.com/site_images/12575b9d51464889428.png',sK:'dbb130feab257219df5ec315dceda764',sSd:'circuitdigest',sSi:'1257',powBy:'1',isEu:true,isSponsored:false,allowedDomain:["circuitdigest.com","circuitdigest.pushengage.com"],vapidPubKey:'BJm17MTshXf56J6cR8-f3ydc62HUpaP6uVN1wgsJIlYL66SHU_upC8ddYjrqrDlCLcD8WB8QVesUcOhBFsPO1LY',plateform:'html'},optinSettings:{"intermediate":{"bg":"#ffffff","page_heading":"Click on Allow to get Notifications from 'circuitdigest'","page_tagline":"Get Updates from 'circuitdigest' through push notifications"},"activeOptin":{"http":{"type":1,"types":[1]},"https":{"type":"4","types":["4"]}},"optins":{"1":{"desktop":{"http":{"allowBtnBg":"#2ecc71","optin_allow_btn_txt":"Allow","bg":"#ffffff","closeBtnBg":"#ffffff","optin_close_btn_txt":"Close","optin_title":"This website 'circuitdigest' would like to send you Push Notifications","placement":"pe-top-center","cookie_duration":7,"optin_category":"delay","optin_delay":1,"optin_scroll":5,"popup_disabled":1,"optin_type":1,"optin_name":"Safari Style Box"},"https":{"allowBtnBg":"#2ecc71","optin_allow_btn_txt":"Allow","bg":"#ffffff","closeBtnBg":"#ffffff","optin_close_btn_txt":"Close","optin_title":"This website 'Circuit Digest' would like to send push notifications","placement":"pe-top-center","cookie_duration":7,"optin_category":"delay","optin_delay":0,"optin_scroll":5,"popup_disabled":1,"optin_type":1,"optin_name":"Safari Style Box","optin_sw_support":0}},"mobile":{"http":{"allowBtnBg":"#2ecc71","optin_allow_btn_txt":"Allow","bg":"#ffffff","closeBtnBg":"#ffffff","optin_close_btn_txt":"Close","optin_title":"This website 'circuitdigest' would like to send you Push Notifications","placement":"pe-mobile-bottom","cookie_duration":7,"optin_category":"delay","optin_delay":1,"optin_scroll":5,"popup_disabled":1,"optin_type":1,"optin_name":"Safari Style Box"},"https":{"allowBtnBg":"#2ecc71","optin_allow_btn_txt":"Allow","bg":"#ffffff","closeBtnBg":"#ffffff","optin_close_btn_txt":"Close","optin_title":"This website 'Circuit Digest' would like to send push notifications","placement":"pe-mobile-bottom","cookie_duration":7,"optin_category":"delay","optin_delay":0,"optin_scroll":5,"popup_disabled":1,"optin_type":1,"optin_name":"Safari Style Box","optin_sw_support":0}}},"2":{"desktop":{"http":{"allowBtnBg":"#2ecc71","optin_allow_btn_txt":"Allow","bg":"#ffffff","closeBtnBg":"#ffffff","optin_close_btn_txt":"Close","optin_title":"This website 'Circuit Digest' would like to send push notifications","placement":"pe-bottom","cookie_duration":7,"optin_category":"delay","optin_delay":0,"optin_scroll":5,"popup_disabled":1,"optin_type":2,"optin_name":"Floating Bar"},"https":{"allowBtnBg":"#2ecc71","optin_allow_btn_txt":"Allow","bg":"#ffffff","closeBtnBg":"#ffffff","optin_close_btn_txt":"Close","optin_title":"This website 'Circuit Digest' would like to send push notifications","placement":"pe-bottom","cookie_duration":7,"optin_category":"delay","optin_delay":0,"optin_scroll":5,"popup_disabled":1,"optin_type":2,"optin_name":"Floating Bar","optin_sw_support":0}},"mobile":{"http":{"allowBtnBg":"#2ecc71","optin_allow_btn_txt":"Allow","bg":"#ffffff","closeBtnBg":"#ffffff","optin_close_btn_txt":"Close","optin_title":"This website 'Circuit Digest' would like to send push notifications","placement":"pe-bottom","cookie_duration":7,"optin_category":"delay","optin_delay":0,"optin_scroll":5,"popup_disabled":1,"optin_type":2,"optin_name":"Floating Bar"},"https":{"allowBtnBg":"#2ecc71","optin_allow_btn_txt":"Allow","bg":"#ffffff","closeBtnBg":"#ffffff","optin_close_btn_txt":"Close","optin_title":"This website 'Circuit Digest' would like to send push notifications","placement":"pe-bottom","cookie_duration":7,"optin_category":"delay","optin_delay":0,"optin_scroll":5,"popup_disabled":1,"optin_type":2,"optin_name":"Floating Bar","optin_sw_support":0}}},"3":{"desktop":{"http":{"cookie_duration":7,"optin_category":"delay","optin_delay":0,"optin_scroll":5,"popup_disabled":1,"optin_title":"Subscribe to notification","bg":"#2ecc71","allowBtnBg":"#ffffff","placement":"pe-bottom-right","optin_type":3,"optin_name":"Bell Placed Bar"},"https":{"cookie_duration":7,"optin_category":"delay","optin_delay":0,"optin_scroll":5,"popup_disabled":1,"optin_title":"Subscribe to notification","bg":"#2ecc71","allowBtnBg":"#ffffff","optin_type":3,"optin_name":"Bell Placed Bar","placement":"pe-bottom-right","optin_sw_support":0}},"mobile":{"http":{"cookie_duration":7,"optin_category":"delay","optin_delay":0,"optin_scroll":5,"popup_disabled":1,"optin_title":"Subscribe to notification","bg":"#2ecc71","allowBtnBg":"#ffffff","optin_type":3,"optin_name":"Bell Placed Bar","placement":"pe-bottom-right"},"https":{"cookie_duration":7,"optin_category":"delay","optin_delay":0,"optin_scroll":5,"popup_disabled":1,"optin_title":"Subscribe to notification","bg":"#2ecc71","allowBtnBg":"#ffffff","optin_type":3,"optin_name":"Bell Placed Bar","placement":"pe-bottom-right","optin_sw_support":0}}},"4":{"desktop":{"https":{"cookie_duration":"7","optin_category":"delay","optin_delay":0,"optin_scroll":5,"popup_disabled":"1","optin_type":"4","optin_name":"Push Single Step Opt-in","optin_sw_support":1,"bell":{"optin_title":"Subscribe to notification","bg":"#1b3343","allowBtnBg":"#ffffff","placement":"pe-bottom-right"}}},"mobile":{"https":{"cookie_duration":"7","optin_category":"delay","optin_delay":0,"optin_scroll":0,"popup_disabled":"1","optin_type":"4","optin_name":"Push Single Step Opt-in","optin_sw_support":1,"bell":{"optin_title":"Subscribe to notification","bg":"#1b3343","allowBtnBg":"#ffffff","placement":"pe-bottom-right"}}}},"6":{"desktop":{"http":{"allowBtnBg":"#2ecc71","optin_allow_btn_txt":"Allow","bg":"#ffffff","closeBtnBg":"#ffffff","optin_close_btn_txt":"Close","optin_title":"This website 'Circuit Digest' would like to send push notifications","placement":"pe-center","cookie_duration":7,"optin_category":"delay","optin_delay":0,"optin_scroll":5,"popup_disabled":1,"optin_type":6,"optin_name":"Large Safari Style Box"},"https":{"allowBtnBg":"#2ecc71","optin_allow_btn_txt":"Allow","bg":"#ffffff","closeBtnBg":"#ffffff","optin_close_btn_txt":"Close","optin_title":"This website 'Circuit Digest' would like to send push notifications","placement":"pe-center","cookie_duration":7,"optin_category":"delay","optin_delay":0,"optin_scroll":5,"popup_disabled":1,"optin_type":6,"optin_name":"Large Safari Style Box","optin_sw_support":0}},"mobile":{"http":{"allowBtnBg":"#2ecc71","optin_allow_btn_txt":"Allow","bg":"#ffffff","closeBtnBg":"#ffffff","optin_close_btn_txt":"Close","optin_title":"This website 'Circuit Digest' would like to send push notifications","placement":"pe-center","cookie_duration":7,"optin_category":"delay","optin_delay":0,"optin_scroll":5,"popup_disabled":1,"optin_type":6,"optin_name":"Large Safari Style Box"},"https":{"allowBtnBg":"#2ecc71","optin_allow_btn_txt":"Allow","bg":"#ffffff","closeBtnBg":"#ffffff","optin_close_btn_txt":"Close","optin_title":"This website 'Circuit Digest' would like to send push notifications","placement":"pe-center","cookie_duration":7,"optin_category":"delay","optin_delay":0,"optin_scroll":5,"popup_disabled":1,"optin_type":6,"optin_name":"Large Safari Style Box","optin_sw_support":0}}},"8":{"desktop":{"http":{"allowBtnBg":"#2ecc71","optin_allow_btn_txt":"Allow","bg":"#ffffff","closeBtnBg":"#ffffff","optin_close_btn_txt":"Close","optin_title":"This website 'Circuit Digest' would like to send push notifications","placement":"pe-center","cookie_duration":7,"optin_category":"delay","optin_delay":0,"optin_scroll":5,"popup_disabled":1,"optin_type":8,"optin_name":"Large Safari Style with Segment","optin_segments":["Segment1","Segment2"]},"https":{"allowBtnBg":"#2ecc71","optin_allow_btn_txt":"Allow","bg":"#ffffff","closeBtnBg":"#ffffff","optin_close_btn_txt":"Close","optin_title":"This website 'Circuit Digest' would like to send push notifications","placement":"pe-center","cookie_duration":7,"optin_category":"delay","optin_delay":0,"optin_scroll":5,"popup_disabled":1,"optin_type":8,"optin_name":"Large Safari Style with Segment","optin_sw_support":0,"optin_segments":["Segment1","Segment2"]}},"mobile":{"http":{"allowBtnBg":"#2ecc71","optin_allow_btn_txt":"Allow","bg":"#ffffff","closeBtnBg":"#ffffff","optin_close_btn_txt":"Close","optin_title":"This website 'Circuit Digest' would like to send push notifications","placement":"pe-center","cookie_duration":7,"optin_category":"delay","optin_delay":0,"optin_scroll":5,"popup_disabled":1,"optin_type":8,"optin_name":"Large Safari Style with Segment","optin_segments":["Segment1","Segment2"]},"https":{"allowBtnBg":"#2ecc71","optin_allow_btn_txt":"Allow","bg":"#ffffff","closeBtnBg":"#ffffff","optin_close_btn_txt":"Close","optin_title":"This website 'Circuit Digest' would like to send push notifications","placement":"pe-center","cookie_duration":7,"optin_category":"delay","optin_delay":0,"optin_scroll":5,"popup_disabled":1,"optin_type":8,"optin_name":"Large Safari Style with Segment","optin_sw_support":0,"optin_segments":["Segment1","Segment2"]}}}}},customUrl:false,widget:{boxStyle:'<style id="PE-chicklet-inst-modal-style">#PE-chicklet-inst-modal{position:fixed;z-index:9999999999!important;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#000;background-color:rgba(0,0,0,.4);overflow-x:hidden}#PE-chicklet-inst-modal #PE-chicklet-inst-modal-content{background-color:#fefefe;left:50%;transform:translate(-50%,-50%);top:50%;position:absolute;border-radius:3px}#PE-chicklet-inst-modal #PE-chicklet-inst-modal-content #PE-chicklet-inst-modal-body #PE-step-img{display:block;margin:0 auto;box-shadow:0 0 5px #bbb}@media(max-width:560px){#PE-chicklet-inst-modal #PE-chicklet-inst-modal-content{width:100%;left:0;top:0;transform:translate(0,0)}#PE-chicklet-inst-modal #PE-chicklet-inst-modal-content #PE-chicklet-inst-modal-body #PE-step-img{argin:auto;width:100%}}#PE-chicklet-inst-modal #PE-chicklet-inst-modal-content #PE-chicklet-inst-modal-body{padding:20px}#PE-chicklet-inst-modal #PE-chicklet-inst-modal-content #PE-chicklet-inst-modal-body #PE-button-box{float:right;padding:40px}#PE-chicklet-inst-modal #PE-chicklet-inst-modal-content #PE-chicklet-inst-modal-body #PE-button-box a#PE-cancel-btn{display: inline;cursor: pointer;color:#042048;text-decoration:none}#PE-chicklet-inst-modal #PE-chicklet-inst-modal-content #PE-chicklet-inst-modal-body #PE-button-box a#PE-retry-btn{display: inline;cursor: pointer;box-shadow:0 7px 14px rgba(50,50,93,.1),0 3px 6px rgba(0,0,0,.08);margin:0 18px;height:45px;line-height:45px;border-radius:2px;background:#449afe;color:#fff;padding:10px 16px;text-decoration:none}#PE-retry-btn p,#PE-cancel-btn p{margin: 0;padding: 0;display:inline-block}</style>',boxHtml:'<div id="PE-chicklet-inst-modal"><div id="PE-chicklet-inst-modal-content"><div id="PE-chicklet-inst-modal-body"><div id="PE-chicklet-inst-modal-body-message"><p style="font-size:18px;margin-bottom:40px;line-height:24px;text-align:center">You seem to have previously blocked/denied/unsubscribed push notifications. See the image below to know how to unblock/resubscribe them.</p><img id="PE-step-img" src=""></div><div id="PE-button-box"><a  id="PE-cancel-btn">Cancel</a> <a id="PE-retry-btn">Retry</a></div></div></div></div>',bWBoxImg:{"url":"https:\/\/assetscdn.pushengage.com\/site_assets\/img\/","chrome":"chrome.jpg","firefox":"firefox.jpg","chromeM":"chromeM.jpg","firefoxM":"firefoxM.jpg","safari":"safari.jpg","edge":"edge.jpg","opera":"opera.jpg","operaM":"operaM.jpg","ucM":"ucM.jpg"},},getWidget:{"status":true,"style":"<style id=\"pe-widget-bell-style\">#pe-widget-bell{bottom:50px;position:fixed;cursor:pointer;display:block;background:#001e47;color:#fff;z-index:999999999999999;border-radius:50%;width:50px;height:50px;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12);margin:0;padding:0;bottom:50px}#pe-widget-bell.pe-bottom-right{right:30px}#pe-widget-bell.pe-bottom-left{left:30px}#pe-widget-bell-launcher-message{right:60px;position:absolute;bottom:0;text-align:center;top:12px;cursor:pointer;-webkit-filter:drop-shadow(0 2px 4px rgba(34,36,38,0));filter:drop-shadow(0 2px 4px rgba(34,36,38,0));z-index:99999999999999;pointer-events:none;display:none;height:35px;max-width:380px}#pe-widget-bell-launcher-message-body{color:#fff;font-size:14px;max-width:100%;white-space:nowrap;text-overflow:ellipsis;display:block;background:#000;padding:9px;border-radius:5px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}#pe-widget-bell-icon-body{text-align:center}#pe-widget-bell-icon{margin:5px}.pe-bottom-left #pe-widget-bell-launcher-message{left:60px;right:unset}.pe-bottom-right #pe-widget-bell-launcher-message{right:60px}.pe-bottom-right #pe-widget-bell-launcher-message-body:after{left:100%;top:50%;border:solid transparent;content:\" \";height:0;width:0;position:absolute;pointer-events:none;border-color:transparent transparent transparent #000;border-width:7px;margin-top:-7px}.pe-bottom-left #pe-widget-bell-launcher-message-body:after{right:100%;top:50%;border:solid transparent;content:\" \";height:0;width:0;position:absolute;pointer-events:none;border-color:transparent #000 transparent transparent;border-width:7px;margin-top:-7px}<\/style>","html":"<div id=\"pe-widget-bell\" class=\"pe-bottom-right\" style=\"background:#042048;\">\n        <div id=\"pe-widget-bell-launcher-message\">\n          <div id=\"pe-widget-bell-launcher-message-body\">\n          Subscribe to notification\n          <\/div>\n        <\/div>\n        <div id=\"pe-widget-bell-icon-body\">\n          <svg style=\"width:40px;height:40px\" viewBox=\"0 0 24 24\" id=\"pe-widget-bell-icon\">\n            <path fill=\"#ffffff\" d=\"M12,22A2,2 0 0,0 14,20H10A2,2 0 0,0 12,22M18,16V11C18,7.93 16.36,5.36 13.5,4.68V4A1.5,1.5 0 0,0 12,2.5A1.5,1.5 0 0,0 10.5,4V4.68C7.63,5.36 6,7.92 6,11V16L4,18V19H20V18L18,16Z\"><\/path>\n          <\/svg>\n        <\/div>\n      <\/div>","data":{"settings":{"type":"bell","enabled":true,"delay":"0"},"bell":{"bg":"#042048","color":"#ffffff","position":"br","label":"Subscribe to notification"}}},subA:false,welcomeNoti:false,subRule:{activeType:false,isResetDelay:false,},optinMang:false,optinSubscriptionTrigger:false,optinSubscriptionReminder:false,safari:{pushId:'web.com.pushengage.safari',default:true},gcm:{projectId:'878680551191'},api:{backendApi:'https://clients-api.pushengage.com/p/v1',safariApi:'https://safari.pushengage.com',swv:'2.3.0',triggerApi:'https://m4xrk918t5.execute-api.us-east-1.amazonaws.com/beta/streams/production_triggers/records',pushJs:'https://clientcdn.pushengage.com/pushengage.js',anyApi:'https://oeqepmcz7a.execute-api.us-east-1.amazonaws.com/beta/streams/optin/records',eventApi:'https://clients-api.pushengage.com/p/v1',taboolaApi:'https://api.taboola.com/1.2',taboolaApiKey:'a460a30141a022c6dc01526bba996da108798fd0',},trigger:{status:false},overlay:{status:false,style:'',html:'',powByHtml:'',powBycss:''},customOptin:{status:false,optinType:false,css:''},subMangWidget:{status:true,settings:{"rule":"all","customRule":"exact","customRuleValue":"https:\/\/circuitdigest.com","type":"button","enabled":true},html:'<div id="pe-button-sub-mang-widget" class="pe-pos-br"><span id="pe-unsubscribe-btn">Unsubscribe to notifications</span><span id="pe-unsubscribe-btn-action">Are you sure?<span id="pe-unsubscribe-btn-yes">Yes</span><span id="pe-unsubscribe-btn-no">No</span></span></div>',css:'<style>#pe-button-sub-mang-widget.pe-pos-br{right:0;bottom:0}#pe-button-sub-mang-widget{position:fixed;cursor:pointer;display:block;background:#001e47;color:#ffffff;padding:0 10px;border-radius:4px 4px 0 0;font-size:15px;z-index:999999999999999;font-weight:400!important;line-height:34px!important;bottom:0;right:0}.PE-backdrop{position:fixed;top:0;left:0;z-index:1035;background-color:rgba(0,0,0,.5);display:none}#pe-button-sub-mang-widget.pe-pos-bl{bottom:0;left:0;right:unset}#pe-button-sub-mang-widget #pe-unsubscribe-btn-action span{text-decoration: underline;margin: 0 10px;}#pe-button-sub-mang-widget #pe-unsubscribe-btn-action{display:none}</style>',msg:{"unsubMsg":"Unsubscribe to notifications","thankMsg":"You will be missing latest notifications","confirmMsg":"Are you sure?"}},privacySettings:{"geoLocationEnabled":true},segmentsOnPageLoad:[],serviceWorker:false,optinSubscriptionRule:false,};var _peD={optinTriggerEvent:'on_load',parse:function(jsonString){var parseData={};try{parseData=JSON.parse(jsonString);}
catch(e){}
return parseData;},stringify:function(objectData){var jsonString='{}';try{jsonString=JSON.stringify(objectData);}
catch(e){}
return jsonString;},objectAssign:function(){var res={};for(var i=0;i<arguments.length;i++){for(var x in arguments[i]){res[x]=arguments[i][x];};};return res;},merchantConfig:{},merchantSettings:{sm:function(parms){var smPath={worker:"/service-worker.js",manifest:"https://"+_peSd.site.sSd+"."+_peSd.config.domain+"/manifest.json",workerStatus:true,scope:true};if(_peSd.site.plateform=="shopify"){smPath.worker="/apps/pushengage/service-worker.js";smPath.scope=false;}
if(_peD.isHttpsSite()&&!(window.opener&&window.location.href.indexOf(_peSd.config.domain)!==-1)){var serviceWorkerSetting=_peSd.serviceWorker;if(serviceWorkerSetting){if(!serviceWorkerSetting.worker){delete serviceWorkerSetting.worker;}
smPath=_peD.objectAssign(smPath,serviceWorkerSetting);}
if(typeof(_peD.merchantConfig)!="undefined"){smPath=_peD.objectAssign(smPath,_peD.merchantConfig);}
if(typeof(pathvars)!="undefined"){smPath=_peD.objectAssign(smPath,pathvars);}}
if(smPath.worker.indexOf('http://')!=0&&smPath.worker.indexOf('https://')!=0&&smPath.worker.indexOf('/')!=0){smPath.worker='/'+smPath.worker;}
switch(parms){case"worker":return smPath.worker;break;case"manifest":return smPath.manifest;break;case"workerStatus":return smPath.workerStatus;break;case"scope":return smPath.scope;break;default:}},cookie:function(){if(typeof pathvars!="undefined"&&pathvars.hasOwnProperty('cookie')&&pathvars.cookie.hasOwnProperty('sites')&&pathvars.cookie.hasOwnProperty('fileName')){return pathvars.cookie;}
else{return false;}},sites:{}},publicKey:function(base64String){var padding='='.repeat((4-base64String.length%4)%4);var base64=(base64String+padding).replace(/\-/g,'+').replace(/_/g,'/');var rawData=window.atob(base64);var outputArray=new Uint8Array(rawData.length);for(var i=0;i<rawData.length;++i){outputArray[i]=rawData.charCodeAt(i);}
return outputArray;},cookie:{optinHide:7,global:1460,get:function(cname){var cookieValue="";if(localStorage.getItem(cname)!=null)cookieValue=localStorage.getItem(cname);if(!cookieValue){var name=cname+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1);if(c.indexOf(name)==0)cookieValue=c.substring(name.length,c.length);}}
return cookieValue;},set:function(data){data.forEach(function(e){var eT=new Date();eT.setDate(eT.getDate()+e[2]);eT=new Date(eT).toUTCString();if(e[4]=="local"){localStorage.setItem(e[0],e[1]);}
else{document.cookie=''+e[0]+'='+e[1]+'; expires='+eT+';path='+e[3]+';SameSite=Lax';if(typeof navigator.cookieEnabled!='undefined'&&!navigator.cookieEnabled)
localStorage.setItem(e[0],e[1]);}});},remove:function(data){data.forEach(function(e){if(e[1]=="local"){localStorage.removeItem(e[0]);}});}},funExecState:{widget:false,optinData:{"1":false,"2":false,"3":false,"4":false,"6":false,"8":false,},peSubscribe:false,subscribe:false,unsubWidget:false,checkSubscriptionIframe:false},resetFunExecState:function(){_peD.funExecState.widget=false;_peD.funExecState.optinData={};_peD.funExecState.peSubscribe=false;_peD.funExecState.subscribe=false;_peD.funExecState.unsubWidget=false;_peD.funExecState.checkSubscriptionIframe=false;},getJSONDataFromLStorage:function(id){var data;try{data=_peD.cookie.get(id)||'{}';data=JSON.parse(data);}
catch(error){data={};}
return data;},getDataUrl:function(n){var url=window.location.href;n=n.replace(/[\[\]]/g,"\\$&");var regex=new RegExp("[?&]"+n+"(=([^&#]*)|&|#|$)"),results=regex.exec(url);if(!results)return null;if(!results[2])return'';return decodeURIComponent(results[2].replace(/\+/g," "));},getInputUrl:function(n){var val=_peD.getDataUrl(n);return(val=='true')?true:false;},isExpireCookie:function(data){if(!data||!data.max_age)return false;return new Date().getTime()-data.max_age<0;},removeOptinsHtml:function(){[1,2,3,6,8].forEach(function(optinId){const isOptinId=_peD.getId('pe_confirm_optin_'+optinId);_peD.rvHtml(isOptinId);});_peD.rvHtml(_peD.getId('PE-chicklet'));},subOptinType:function(action){var optinType=_peD.getDataUrl("optin_type");if(optinType)return Number(optinType);var pushBeforeSubData=_peD.getJSONDataFromLStorage('PushBeforeSubData');if(action=='allow'&&pushBeforeSubData.allow_optin_id){return pushBeforeSubData.allow_optin_id;}
if(action=='close'&&pushBeforeSubData.close_optin_id){return pushBeforeSubData.close_optin_id;}
return Number(_peD.getActiveOptinTypes()[0]||_peD.getActiveOptinType());},subSegment:function(){var val=_peD.getDataUrl("segment");return(val)?val:false;},subUrl:function(){return _peD.getInputUrl('intermediate')?document.referrer||_peD.getDataUrl("sub_url"):window.location.href;},deviceToken:{cookie:function(){var cValue=_peD.cookie.get("PushSubscriberID");return(cValue!='false'&&cValue!='')?_peD.getDeviceTokenFromEndPoint(cValue):false;},value:false,status:function(){return(_peD.cookie.get("PushSubscriberStatus")=="SUBSCRIBED")?true:false;}},bW:function(){var ua=navigator.userAgent,tem,uai,M=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];uai=(ua.indexOf('Edge')==-1)?ua.indexOf('EdgA'):ua.indexOf('Edge');if(uai!=-1){tem=ua.substring(uai,uai+7).split("/");return{name:'Edge',version:(tem[1]||'')};}
uai=ua.indexOf('Edg');if(uai!=-1){tem=ua.substring(uai,uai+6).split("/");return{name:'Edge',version:(tem[1]||'')};}
if(/trident/i.test(M[1])){tem=/\brv[ :]+(\d+)/g.exec(ua)||[];return{name:'IE',version:(tem[1]||'')};}
uai=ua.indexOf('UCBrowser');if(uai!=-1){tem=ua.substring(uai,uai+12).split("/");return{name:'Ucbrowser',version:(tem[1]||'')};}
uai=ua.indexOf('OPR');if(uai!=-1){tem=ua.substring(uai,uai+6).split("/");return{name:'Opera',version:(tem[1]||'')};}
uai=ua.indexOf('YaBrowser');if(uai!=-1){tem=ua.substring(uai,uai+12).split("/");return{name:'Yandex',version:(tem[1]||'')};}
M=M[2]?[M[1],M[2]]:[navigator.appName,navigator.appVersion,'-?'];if((tem=ua.match(/version\/(\d+)/i))!=null){M.splice(1,1,tem[1]);}
return{name:M[0],version:M[1]};},dT:function(){var dTCheck='desktop';dTCheck=(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))?'mobile':dTCheck;return dTCheck;},sT:function(){if(_peD.bW().name=="Safari"){return'https';}
return location.protocol.slice(0,-1);},insertFile:function(type,fName,src,callback){var head=document.getElementsByTagName('head')[0];switch(type){case'css':var src=(src)?src:'https://'+_peSd.site.sSd+'.'+_peSd.config.domain+'/'+fName+'.css';var link=document.createElement('link');link.rel='stylesheet';link.type='text/css';link.href=src;link.media='screen';head.appendChild(link);break;case'js':if(fName=="pushengage-geo"&&!_peSd.privacySettings.geoLocationEnabled)
return callback(true);var src=(src)?src:'https://'+_peSd.site.sSd+'.'+_peSd.config.domain+'/'+fName+'.js';var script=document.createElement('script');script.src=src;script.onload=function(){if(typeof callback=='function')
return callback(true);};head.appendChild(script);break;case'iframe':var src=(src)?src:'https://'+_peSd.site.sSd+'.'+_peSd.config.domain+'/'+fName+'.php';document.getElementsByTagName("BODY")[0].insertAdjacentHTML('beforeend','<iframe src="'+src+'" style="display:none;width:0px;height:0px;border:0px;" id="pe-'+fName+'-iframe"></iframe>');}},bWSupport:function(){var bwSupport=false;var bW=_peD.bW();bwSupport=((bW.name=="Chrome"&&bW.version>=49)||(bW.name=="Firefox"&&bW.version>=46)||(bW.name=="Safari"&&_peD.dT()=="desktop"&&bW.version>=7&&bW.version!=10&&!_peSd.safari.default)||(bW.name=="Opera"&&((bW.version>=37&&_peD.dT()=="mobile")||(bW.version>=43&&_peD.dT()=="desktop")))||(bW.name=="Edge"&&bW.version>=17)||(bW.version>=12&&bW.name=="Ucbrowser"&&_peD.dT()=="mobile"))?true:bwSupport;bwSupport=(!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform))?false:bwSupport;return bwSupport;},subOptinShow:function(optinId){var subOptinShow=false;if((_peD.cookie.get("peclosed")===""||_peD.cookie.get("peclosed")==="false")&&(_peD.cookie.get("PushSubscriberID")==="false"||_peD.cookie.get("PushSubscriberID")===""))
subOptinShow=true;var newOptinId=optinId||_peD.subOptinType();if(_peD.sT()=="https"&&_peD.swSupport(newOptinId)=="1"){if(Notification.permission=="default"&&_peD.cookie.get("PushSubscriberID")!="")
subOptinShow=true;else if(_peD.cookie.get("peclosed")===""||_peD.cookie.get("peclosed")==="false")
subOptinShow=true;}
else{if(_peD.cookie.get("peclosed")===""||_peD.cookie.get("peclosed")==="false")subOptinShow=true;}
return subOptinShow;},getActiveOptinType:function(){var siteType=_peD.sT(),browser=_peD.bW();;var type=_peSd.optinSettings.activeOptin[siteType].type;var types=_peSd.optinSettings.activeOptin[siteType].types
if((typeof dialog_box!='undefined'&&dialog_box==true)){return 4;}
return types[0]?Number(types[0]):Number(type);},getActiveOptinTypes:function(){var siteType=_peD.sT(),deviceType=_peD.dT(),browser=_peD.bW();;var types=_peSd.optinSettings.activeOptin[siteType].types;if((typeof dialog_box!='undefined'&&dialog_box==true)){types=[4];_peSd.subRule.activeType="delay";_peSd.subRule.isResetDelay=true;}
if((browser.name=="Safari"||(browser.name=="Firefox"&&browser.version>71))&&(types.includes(4)||types.includes('4'))){types=types.filter(function(optinId){return 4!=optinId;});if(!types.includes(3)||!types.includes('3')){types.push(3);Object.assign(_peSd.optinSettings.optins[3][deviceType][siteType],_peSd.optinSettings.optins[4][deviceType][siteType].bell||{},{popup_disabled:1,optin_sw_support:1,optin_category:'delay',optin_delay:0});}}
return types.map(function(type){return Number(type)});},getOptinSettings:function(optinId){var tOptinSettings={},browser=_peD.bW(),deviceType=_peD.dT(),siteType=_peD.sT();return _peSd.optinSettings.optins[optinId][deviceType][siteType];},isDisableSubscriptionByUser:function(){var activeOptins=_peD.getActiveOptinTypes();var isDisabled=true;activeOptins.forEach(function(optinId){var optinSetting=_peD.getOptinSettings(optinId);if(optinSetting.popup_disabled){isDisabled=false;}});return isDisabled;},swSupport:function(optinId){var optinSetting=_peD.getOptinSettings(optinId);var browser=_peD.bW();if((optinId==4&&_peD.sT()=='https')||browser.name=="Safari"){return 1;}
return optinSetting.optin_sw_support||0;},userPerDenied:function(optinId){var newOptinId=optinId||_peD.subOptinType();var perDenied=(Notification.permission=="denied"||_peD.cookie.get("PushSubscriberStatus")=="CLOSED")?true:false;perDenied=(_peD.sT()=="http")?false:(_peD.swSupport(newOptinId)=="0"&&!_peD.getInputUrl('intermediate'))?false:perDenied;perDenied=(_peD.cookie.get('PushSubscriberStatus')=='UNSUBSCRIBED'||_peD.cookie.get('PushSubscriberStatus')=='CLOSED'||_peD.cookie.get('PushSubscriberStatus')=='DENIED')?true:perDenied;return perDenied;},checkUserSubHttp:function(){return(_peD.cookie.get("peclosed")=="true"&&_peD.cookie.get("PushSubscriberID")!=""&&_peD.cookie.get("PushSubscriberHash")!=""&&!_peD.userPerDenied())?true:false;},isPrivateBrowserForNewChrome:function(){return new Promise(function getPrivateBrowser(resolve){if('storage'in navigator&&'estimate'in navigator.storage){navigator.storage.estimate().then(function(bwData){if(bwData.quota<120000000){resolve(true);}else{resolve(false);}});}else{resolve(false);}});},pvtBw:function(callback){var bW=_peD.bW();var browserName=bW.name;var browserVersion=bW.version;if(browserName==="Edge"&&browserVersion>="79"){browserName='Chrome';}
switch(browserName){case'Chrome':case'Opera':if(browserVersion<74){var fs=window.RequestFileSystem||window.webkitRequestFileSystem;if(!fs)return;fs(window.TEMPORARY,100,function(fs){callback(false);},function(err){callback(true);});}
else{_peD.isPrivateBrowserForNewChrome().then(function(isPrivate){callback(isPrivate);});}
break;case'Firefox':var db=indexedDB.open("test");db.onerror=function(){callback(true);};db.onsuccess=function(){callback(false);};break;case'Safari':var storage=window.sessionStorage;try{storage.setItem("someKeyHere","test");storage.removeItem("someKeyHere");callback(false);}catch(e){if(e.code===DOMException.QUOTA_EXCEEDED_ERR&&storage.length===0){callback(true);}}
break;case'Edge':try{localStorage.test=2;callback(false);}catch(e){callback(true);}
break;case'Ucbrowser':callback(false);break;default:callback(true);}},checkApiValid:function(){return(_peD.bWSupport())?true:false;},getId:function(id){return document.getElementById(id);},httpRequest:function(data,callback){var method=(data.method)?data.method:"GET";var xhttp=new XMLHttpRequest();xhttp.onreadystatechange=function(){if(xhttp.readyState==4&&typeof callback==='function'){if(xhttp.responseText!=''&&typeof xhttp.responseText=='string')
return callback({data:xhttp.responseText,status:xhttp.status});}};var query=data.query||{};query=Object.keys(query).map(function(key){return key+'='+encodeURIComponent(query[key])}).join('&');var seperator=(data.url.indexOf("?")===-1)?'?':'&';var url=query?data.url+seperator+query:data.url;xhttp.open(method,url,true);if(data.requestHeader){data.requestHeader.forEach(function getHeader(header){xhttp.setRequestHeader(header.name,header.value);});}
var data=data.reqData||{};xhttp.send(JSON.stringify(data));},sendRequestToServer:function(data,callback){var method=(data.method)?data.method:"POST";var reqData=data.reqData||{};if(data.isSiteId!=false)
reqData.site_id=Number(_peSd.site.sSi);var query=data.query||{};query.swv=_peSd.api.swv;query.bv=_peE.bW.name;var url=(data.baseUrl||_peSd.api.backendApi)+data.relApiPath;_peD.httpRequest({method:method,reqData:reqData,query:query,url:url,requestHeader:[{name:'Content-type',value:'application/json'}]},function(res){return callback(res.data);})},optinAnalytics:function(data){var widgetOptinType=_peD.widget.optinType;if(!_peSd.subA||(data.optin_type==widgetOptinType&&_peD.cookie.get("PushSubscribeWidgetAnalytics")==1))return;if(!data.optin_type)
data.optin_type=_peD.subOptinType();data.site_id=_peSd.site.sSi;var reqData={Data:data,PartitionKey:'optin_analytics'};_peD.httpRequest({method:'PUT',reqData:reqData,url:_peSd.api.anyApi,requestHeader:[{name:'Content-type',value:'application/json'}]});if(data.optin_type==widgetOptinType){_peD.cookie.set([['PushSubscribeWidgetAnalytics',1,'','/','local']]);}},resetStorage:function(){_peD.cookie.set([['PushSubscriberID','',_peD.cookie.global,'/','local'],['PushSubscriberStatus','',_peD.cookie.global,'/','cookie'],['PushSubscribeWidgetClosed',0,false,'/','local'],['PushSegments',JSON.stringify({}),false,'/','local'],]);},hideHtml:function(e){if(e){e.style.visibility='hidden';e.style.display='none';}},showHtml:function(e){if(e){e.style.visibility='visible';e.style.display='block';}},rvHtml:function(e){if(!e)return;try{e.parentNode.removeChild(e);}
catch(e){}},addContent:function(content){var body=document.getElementsByTagName("BODY")[0];if(body&&content&&typeof content=='object'){content.forEach(function(e){body.insertAdjacentHTML('beforeend',e);});}},widget:{optinType:127,getBoxImg:function(){if(!_peSd.widget.bWBoxImg)return'';var bUrl=(typeof _peSd.widget.bWBoxImg.url!="undefined")?_peSd.widget.bWBoxImg.url:"";var bW=_peD.bW();var browserName=bW.name;var browserVersion=bW.version;if(browserName==="Edge"&&browserVersion>="79"){browserName='Chrome';}
switch(browserName){case'Firefox':return(_peE.dT=='desktop')?bUrl+_peSd.widget.bWBoxImg.firefox:bUrl+_peSd.widget.bWBoxImg.firefoxM;break;case'Safari':return bUrl+_peSd.widget.bWBoxImg.safari;break;case'Edge':return(_peE.dT=='desktop')?bUrl+_peSd.widget.bWBoxImg.edge:bUrl+_peSd.widget.bWBoxImg.chromeM;break;case'Opera':return(_peE.dT=='desktop')?bUrl+_peSd.widget.bWBoxImg.opera:bUrl+_peSd.widget.bWBoxImg.operaM;break;case'Ucbrowser':return(_peE.dT=='desktop')?bUrl+_peSd.widget.bWBoxImg.chrome:bUrl+_peSd.widget.bWBoxImg.ucM;break;default:return(_peE.dT=='desktop')?bUrl+_peSd.widget.bWBoxImg.chrome:bUrl+_peSd.widget.bWBoxImg.chromeM;}},status:function(){if(_peSd.getWidget.status&&_peD.cookie.get('PushSubscribeWidgetClosed')!="1")return true;return false;},execStatus:function(){if((_peD.userPerDenied()||_peD.cookie.get('peclosed')=="false")&&(_peD.userPerDenied()||!_peD.deviceToken.cookie())||(_peD.cookie.get("PushSubscriberStatus")=="CLOSED"&&Notification.permission=="default"))
return true;return false;},addHtml:function(callback){if(_peD.funExecState.widget)return;_peD.funExecState.widget=true;if(!_peD.widget.status()||!_peD.widget.execStatus()){return;}
var widgetSetting=_peSd.getWidget.data;var delay=widgetSetting.settings.delay;if(typeof delay=="string"){var delay=Number(delay);}
setTimeout(function(){_peD.addContent([_peSd.getWidget.style,_peSd.getWidget.html]);if(typeof widgetSetting.button!="undefined"){var widget=_peD.getId("PE-chicklet"),widgetCloseBtn=_peD.getId("pe-chicklet-close-btn"),widgetContent=_peD.getId("PE-chicklet-content");function getWidth(){return widget.offsetWidth;}
var pos,plac;if(_peD.dT()=='mobile'){pos=widgetSetting.button.mobile_position;plac=widgetSetting.button.mobile_placement;}else{pos=widgetSetting.button.desktop_position;plac=widgetSetting.button.desktop_placement;}
switch(pos){case'left':switch(plac){case'top':widget.classList.add('chicklet-left-top');break;case'bottom':widget.classList.add('chicklet-left-bottom');widget.style.transform='rotate(90deg) translateY('+getWidth()+'px)';break;default:widget.classList.add('chicklet-left-center');widget.style.top='calc(50% - '+(getWidth()/2)+'px)';}
break;case'bottom':widgetCloseBtn.style.right="0px";widgetCloseBtn.style.left="unset";switch(plac){case'left':widget.classList.add('chicklet-bottom-left');break;case'right':widget.classList.add('chicklet-bottom-right');break;default:widget.classList.add('chicklet-bottom-center');}
break;default:switch(plac){case'top':widget.classList.add('chicklet-right-top');widget.style.transform='rotate(90deg) translateY(-'+getWidth()+'px)';break;case'bottom':widget.classList.add('chicklet-right-bottom');widget.style.bottom='calc(50% - '+getWidth()/2+'px)';break;default:widget.classList.add('chicklet-right-center');widget.style.bottom='calc(50% - '+getWidth()/2+'px)';}}
if(widgetContent)
widgetContent.addEventListener("click",function(){_peD.widget.onClickWidget(widget,callback);});if(widgetCloseBtn){widgetCloseBtn.addEventListener("click",function(){_peD.rvHtml(widget);var optinId=_peD.subOptinType();_peD.cookie.set([['PushSubscribeWidgetClosed',1,_peE.cookie.getOptinHide(optinId),'/','local']]);});}}
else{var peLuncherMsg=_peD.getId('pe-widget-bell-launcher-message');var widgetBell=_peD.getId('pe-widget-bell');var widgetBellBody=_peD.getId('pe-widget-bell-icon-body');if(widgetBell&&widgetBellBody){widgetBellBody.addEventListener("click",function(){_peD.widget.onClickWidget(widgetBell,callback);});widgetBellBody.addEventListener('mouseover',function(){_peD.showHtml(peLuncherMsg);});widgetBellBody.addEventListener('mouseout',function(){_peD.hideHtml(peLuncherMsg);});}}},delay*1000);},onClickWidget:function(widget,callback){_peD.funExecState.widget=_peD.funExecState.peSubscribe=false;_peE.widgetClick=true;_peD.optinAnalytics({allow_1:true,optin_1:true,optin_type:_peD.widget.optinType});if(_peD.cookie.get("PushSubscriberStatus")=="UNSUBSCRIBED")
_peE.refToken=true;_pe.showOptin(callback,{},_peD.getActiveOptinType());_peD.rvHtml(widget);_peD.rvHtml(_peD.getId('pe-widget-bell-style'));_peD.rvHtml(_peD.getId('PE-chicklet-style'));},addBoxHtml:function(callback){var optinId=_peD.subOptinType();function resubscribe(){_peD.resetStorage();_peSd.subRule.activeType="delay";_peSd.subRule.isResetDelay=true;if(typeof pe=="undefined"){_pe.peSubscribe({},callback);}
else{pe.subscribe(callback);}}
if(Notification.permission=='granted'&&_peD.cookie.get("PushSubscriberStatus")=="UNSUBSCRIBED"){_peE.refToken=true;return resubscribe();}
if(Notification.permission=='default'&&_peD.cookie.get("PushSubscriberStatus")=="CLOSED"){return resubscribe();}
_peD.addContent([_peSd.widget.boxStyle,_peSd.widget.boxHtml]);var imgId=_peD.getId("PE-step-img");if(imgId)imgId.src=_peD.widget.getBoxImg();var widget=_peD.getId("PE-chicklet-inst-modal");if(widget){widgetC=_peD.getId("PE-cancel-btn");widgetC.addEventListener("click",function(){_peD.rvHtml(widget);_peD.rvHtml(_peD.getId('PE-chicklet-inst-modal-style'));if(_peE.sT=="https"&&_peD.swSupport(optinId)==1)
_peD.widget.addHtml(callback);if(_peD.getInputUrl('intermediate'))pe.sendDataToBrowser();});widgetR=_peD.getId("PE-retry-btn");widgetR.addEventListener("click",function(){if(Notification.permission=='granted'||Notification.permission=='default'){_peD.rvHtml(widget);_peD.rvHtml(_peD.getId('PE-chicklet-inst-modal-style'));if(Notification.permission=='default'&&_peD.subOptinType()=="4"){_peD.cookie.set([['PushSubscriberStatus','','/','cookie']]);location.reload();}else{resubscribe();}}});}},resetClosedCookie:function(){_peD.cookie.set([['PushSubscribeWidgetClosed',0,1,'/','local']]);}},allowedDomain:function(){var dAllow=true;_peSd.site.allowedDomain.forEach(function(e){if(e.indexOf(location.hostname)!=-1)
dAllow=true;});return dAllow;},getDeviceTokenFromEndPoint:function(endpoint,status){if(typeof endpoint=="string"){if(status=="init"){_peD.deviceToken.value=endpoint;}
else{var token=(endpoint.indexOf('token=')>-1)?endpoint.slice(endpoint.search("token=")+6):endpoint.split("/")[endpoint.split("/").length-1];return token;}}
else{return false;}},getSubscription:function(callback){if(_peE.bW.name!="Safari"){navigator.serviceWorker.getRegistrations().then(function(reg){if(reg.length!=0){var subApi;if(_peD.merchantSettings.sm('scope')){subApi=navigator.serviceWorker.ready;}
else{subApi=navigator.serviceWorker.register(_peD.merchantSettings.sm('worker'));}
subApi.then(function(reg1){reg1.pushManager.getSubscription().then(function(sub){if(sub)return callback({worker:true,sub:sub});return callback({worker:true,sub:false});})});}
else callback({worker:false,sub:false});}).catch(function(e){callback({worker:false,sub:false});});}
else{var sub=window.safari.pushNotification.permission(_peSd.safari.pushId);if(sub.permission==='granted'&&sub.deviceToken)
return callback({worker:true,sub:sub});else
return callback({worker:true,sub:false});}},bwUnsubscribe:function(){return new Promise(function(resolve,reject){var optinId=_peD.subOptinType();if(_peE.bW.name=="Safari"||_peD.cookie.get('PushSubscribed')=="true"){return resolve({statuscode:1});}
else{if(_peE.sT=="https"){if(_peD.swSupport(optinId)==1){_peD.bwUnsubscribeAPI(resolve);}
else{_peD.insertFile('iframe','unsubscribe',false);return resolve({statuscode:1});}}
else{return resolve({statuscode:1});}}});},bwUnsubscribeAPI:function(callback){_peD.getSubscription(function(res){if(res.worker&&res.sub){res.sub.unsubscribe().then(function(){return callback({statuscode:1});}).catch(function(e){return callback({statuscode:0});})}
else return callback({statuscode:1});});},recoverSubscriber:function(callback){var optinId=_peD.subOptinType();if(_peE.bW.name!="Safari"&&'serviceWorker'in navigator){Promise.all([_peD.bwUnsubscribe()]).then(function(res){if(_peE.sT=="https"&&_peD.swSupport(optinId)==1)
_pe.peSubscribe({resub:true},callback);else
pe.subscribe(callback)});}
else
_pe.peSubscribe({resub:true},callback);},resetCookie:function(){_peD.cookie.set([['peclosed','',1,'/','cookie'],['PushSubscriberStatus','',1,'/','cookie'],['PushSubscriberID','',false,'/','local'],['PushSubscriberHash','',false,'/','local'],['PushPersonalNotificationStatus','',false,'/','local']]);},getTimezone:function(){try{var date=Date().match(/([\+-][0-9]+)/)[0].split("");var timezone=date[0]+date[1]+date[2]+":"+date[3]+date[4];}
catch(e){var timezone="+00:00";}
return timezone;},modifyGeo:function(geoInfo){var timezone=_peD.getTimezone();var geo={geobytestimezone:timezone};if(typeof geoInfo==="object"){geo=_peD.objectAssign(geo,geoInfo);if(_peSd.site.isEu&&geo.geobytesipaddress){try{var ip=geo.geobytesipaddress;var ip_array=ip.split(".");ip_array.pop();geo.geobytesipaddress=ip_array.join(".");}
catch(e){delete geo.geobytesipaddress;}}}
return geo;},isHttpsSite:function(){var isHttps=false;var optinId=_peD.subOptinType();if(_peD.sT()=="https"&&_peD.swSupport(optinId)==1){isHttps=true;}
return isHttps;},removeExecHtml:function(){_peD.rvHtml(_peD.getId('pe_confirm'));_peD.rvHtml(_peD.getId('PE-chicklet'));_peD.rvHtml(_peD.getId('PE-chicklet-style'));_peD.rvHtml(_peD.getId('pe-widget-bell'));_peD.rvHtml(_peD.getId('pe-widget-bell-style'));_peD.rvHtml(_peD.getId('pe-overlay-backdrop'));_peD.rvHtml(_peD.getId('pe-overlay-backdrop-style'));},isQuiterUi:function(){var status=false;var browser=_peD.bW();if(((browser.name==="Chrome"||browser.name==="Edge")&&browser.version>=80)||(_peD.dT()==="desktop"&&browser.name==="Firefox"&&browser.version>=72)||(browser.name==="Opera"&&browser.version>=67)){status=true;}
return status;}};var _peE={bW:_peD.bW(),dT:_peD.dT(),sT:_peD.sT(),bWSupport:_peD.bWSupport(),checkApiValid:_peD.checkApiValid(),subSegment:_peD.subSegment(),cookie:{getOptinHide:function(optinId){return _peD.getOptinSettings(optinId).cookie_duration||_peD.cookie.optinHide;},},subUrl:_peD.subUrl(),refToken:_peD.getInputUrl('ref_token'),widgetClick:_peD.getInputUrl('widget_click')};var _pe={customSiteCookie:{init:0,set:0,notSet:0},_peqi:{queue:[],init:function(q){if(typeof q==='object'&&q.length>0){q.forEach(function(e,i){switch(e[0]){case'init':case'subscribe':case'subscribe-on-click':if(e[0]=='subscribe'||e[0]=='subscribe-on-click'){_peD.optinTriggerEvent="on_click";_peSd.subRule.activeType="delay";_peSd.subRule.isResetDelay=true;_peD.resetFunExecState();_peD.removeExecHtml();_peD.cookie.set([['PushSubscriberStatus','',0,'/','cookie'],['peclosed','',0,'/','cookie'],]);if(_peD.userPerDenied()){return _peD.widget.addBoxHtml(e[2]);}}
if(typeof dialog_box!='undefined'&&dialog_box==true){_peD.insertFile('js',false,_peSd.api.pushJs,function(res){pe.subscribe();});return;}
if(_peD.merchantSettings.cookie()&&_peD.subOptinShow()&&_peD.cookie.get('PushSubscribed')!="true"){_peD.merchantSettings.cookie().sites.forEach(function(e,i){if(e!=''){_peSd.site.allowedDomain.push(e);e=e.replace(/\/$/,'');_peD.insertFile('iframe',_peD.merchantSettings.cookie().fileName.replace(".","-")+i,e+'/'+_peD.merchantSettings.cookie().fileName);}});}
else{if(typeof q[0]==="object"&&typeof q[0][0]==="object"){if(q[0][0].hasOwnProperty('sites')){q[0][0].sites.forEach(function(e1){switch(e1.role){case"resubscribe":_peD.merchantSettings.sites.resubscribe=e1.url;_peSd.site.allowedDomain.push(e1.url);if(_peD.subOptinShow()&&_peE.bW.name!="Safari"){_peD.insertFile('iframe','resubscribe',e1.url+'?intermediate=true&recover_subscriber_from_iframe=true');}
else _pe._peqi.qInit();break;case"recoverSubscriberFromIframe":_peD.merchantSettings.sites.recoverSubscriberFromIframe=e1.url;_peSd.site.allowedDomain.push(e1.url);if(_peE.bW.name!="Safari"){if(_pe.checkSubscriptionStatus('https')){_peD.recoverSubscriber();}
else{var data={state:"notSubscribed",source:"recoverSubscriberFromIframe",postOrigin:"iframe"};parent.postMessage(JSON.stringify(data),'*');}}}});}}
else{switch(e.length){case 2:_pe.subscribe(e[1]);break;case 3:if(typeof e[2]=='function')
_pe.subscribe(e[1],function(res){q[i][2](res)});break;default:_pe.subscribe();}}}
break;case"add-to-segment":if(typeof e[1]!='undefined'){_pe.addSubscriberToSegment(e[1],e[2]);}
break;case"remove-to-segment":if(typeof e[1]!='undefined'){_pe.removeSubscriberFromSegment(e[1],e[2]);}
break;case"add-to-profile":switch(e.length){case 3:if(typeof e[2]=='function')
_pe.addProfileId(e[1],function(res){q[i][2](res)});break;default:if(typeof e[1]!='undefined')
_pe.addProfileId(e[1]);}
break;case"add-to-dynamic-segment":if(e.length>=2){var segments;var cb;if(typeof e[1]=="object"&&e[1].length>0){segments=e[1];cb=e[2];}else if(e.length>=3&&typeof e[1]=='string'&&typeof e[2]==='number'&&e[2]>0){segments=[{name:e[1],duration:e[2]}];cb=e[3];}else{cb=e[2]||e[3];if(typeof cb=='function'){return cb({statuscode:2,mesage:_pe.msg.seg[1]});}
console.error(_pe.msg.segAdd[1]);return;}
_pe.addSubscriberToDynamicSegment(segments,cb);}
break;case"subscriber-status":switch(e.length){case 2:if(typeof e[1]=='function')
_pe.subscriberStatus(function(res){q[i][1](res)});break;}
break;case"add-to-trigger":switch(e.length){case 2:if(typeof e[1]=='object')
_pe.trigger(e[1]);break;}
break;case"add-attributes":_pe.attributeOperationOnSubscriber(e[1],'PUT',e[2]);break;case"remove-attributes":_pe.attributeOperationOnSubscriber(e[1],'DELETE',e[2]);break;case"get-attributes":_pe.attributeOperationOnSubscriber({},'GET',e[1]);break;case"set-attributes":_pe.attributeOperationOnSubscriber(e[1],'POST',e[2]);break;case"event":_pe.sendEvent(e[1],e[2]);break;case"add-alert":_pe.addAlert(e[1],e[2]);break;case"get-alerts":_pe.getAlerts(e[1],e[2]);break;case"remove-alerts":_pe.removeAlerts(e[1],e[2]);break;case"goal":_pe.sendGoal(e[1],e[2]);break;case"get-subscriber":_pe.getSubscriberData(e[1],e[2]);break;case"config":if(typeof e[1]=="object"){_peD.merchantConfig=e[1];}
break;default:}});}},qInit:function(initName){if(typeof _pe._peqi.queue==='object'&&_pe._peqi.queue.length>0){_pe._peqi.queue.forEach(function(e,i){if(e[0]=="init"){_peD.funExecState.subscribe=false;switch(e.length){case 2:_pe.subscribe(e[1]);break;case 3:var f=function(res){_pe._peqi.queue[i][2](res)}
if(initName=="resFun")
return f;_pe.subscribe(e[1],f);break;default:_pe.subscribe();}}});}}},msg:{seg:['Your given segment is not valid','Your given segment or days is not valid'],segAdd:['Segment added successfully','Segment already added','Segment not found'],segRemove:['Segment removed successfully','Segment already removed'],profile:['Profile added successfully','Profile already exists'],error:['Something went wrong','Your browser does not support or, you have disabled PushEngage web push notification','User not subscribed','Your website url is not allowed, please configure in PushEngage correctly',"Subscriber is not valid for request api"],success:["User is unsubscribed successfully","User is unsubscribed to automated personal notifications"]},powByNot:function(){return(_peSd.site.powBy=='1')?true:false;},peSubscribe:function(data,callback){if(_peD.funExecState.peSubscribe)return;_peD.funExecState.peSubscribe=true;if(data.resub){_peE.refToken=true;}
var browser=_peE.bW;if(data.resub&&((browser.name=="Firefox"&&browser.version>72&&!(Notification.permission=='granted'&&_peD.isHttpsSite()))||browser.name=="Safari")){return _pe.optinData(callback,data);}
_peD.insertFile('js',false,_peSd.api.pushJs,function(res){pe.subscribe(callback);});},apiNotValid:function(){if(!_peD.allowedDomain())return{statuscode:20,message:_pe.msg.error[3]};if(!_peE.checkApiValid)return{statuscode:21,message:_pe.msg.error[1]};if(!_peD.deviceToken.cookie()||_peD.userPerDenied())return{statuscode:22,message:_pe.msg.error[2]};if(_peD.deviceToken.cookie()=="true")return{statuscode:23,message:_pe.msg.error[4]};return false;},apiSubNotValid:function(){if(!_peD.allowedDomain())return{statuscode:20,message:_pe.msg.error[3]};if(!_peE.checkApiValid)return{statuscode:21,message:_pe.msg.error[1]};return false;},referUrl:function(refer){refer+="&refer=true";_peD.cookie.set([['PushSubscriberID',true,_peD.cookie.global,'/','local']]);window.location=refer;},showOptin:function(callback,resubscribeData,optinId){_peD.removeOptinsHtml();var referlink='https://'+_peSd.site.sSd+'.'+_peSd.config.domain+'?action=subscribe&optin_type='+optinId+'&intermediate=true&ref_token='+_peE.refToken+'&site_type='+_peE.sT+'&widget_click='+_peE.widgetClick+'&sub_url='+_peE.subUrl;referlink=(_peE.subSegment&&typeof _peE.subSegment=='string')?referlink+'&segment='+_peE.subSegment:referlink;if(_peSd.customUrl&&optinId!=4){referlink=_peSd.customUrl.url;referlink+=((referlink.indexOf('?')==-1)?'?':'&');referlink+='action=subscribe&optin_type='+optinId+'&intermediate=true&site_type='+_peE.sT;referlink=(_peE.subSegment)?referlink+'&segment='+_peE.subSegment:referlink;if(_peSd.customUrl.type=='window'&&typeof window.open==='function'){window.open(referlink,"_blank","width=800, height=600");return;}
else if((_peSd.customUrl.type=='tab'||_peSd.customUrl.type=='same')&&typeof window.open==='function'){window.open(referlink);return;}
_pe.referUrl(referlink);return;}
else if(_peE.sT=='https'||_peE.bW.name=="Safari"){if(_peD.swSupport(optinId)==0){if(typeof window.open==='function'){window.open(referlink,"_blank","width=800, height=600");return;}
else{_pe.referUrl(referlink);return;}}
if(resubscribeData&&resubscribeData.resub){_peD.insertFile('js',false,_peSd.api.pushJs,function(res){pe.subscribe(callback);});return;}
return _pe.peSubscribe({resub:false},callback);}
if(typeof window.open==='function')
window.open(referlink,"_blank","width=800, height=600");else _pe.referUrl(referlink);},handleHtmlOptinEvent:function(optinId,resubscribeData,callback){var peConf=_peD.getId('pe_confirm_optin_'+optinId);var cookieDuration=_peE.cookie.getOptinHide(optinId);var allowBtn=_peD.getId('pe_allow_btn_optin_'+optinId);if(allowBtn){allowBtn.addEventListener('click',function(){if(peConf){if(optinId==8){_peE.subSegment='';for(var i=1;i<=10;i++){if(_peD.getId('pe_seg'+i+'_btn')&&_peD.getId('pe_seg'+i+'_btn').checked&&_peD.getId('pe_seg'+i+'_btn').value){_peE.subSegment+=_peD.getId('pe_seg'+i+'_btn').value+',';}}}
var pushBeforeSubData=_peD.getJSONDataFromLStorage('PushBeforeSubData');Object.assign(pushBeforeSubData,{allow_optin_id:optinId});_peD.cookie.set([['PushBeforeSubData',JSON.stringify(pushBeforeSubData),_peE.false,false,'local']]);_peD.rvHtml(peConf);_pe.showOptin(callback,resubscribeData,optinId);_peD.widget.resetClosedCookie();}});}
var closeBtn=_peD.getId('pe_close_btn_optin_'+optinId);if(closeBtn){closeBtn.addEventListener("click",function(){if(peConf){_peD.optinAnalytics({block_1:true,optin_1:true,optin_type:optinId});_peD.hideHtml(peConf);var pushBeforeSubData=_peD.getJSONDataFromLStorage('PushBeforeSubData');var maxCookieAge=86400000*cookieDuration+new Date().getTime();Object.assign(pushBeforeSubData,{close_optin_id:optinId,['close_optin_id_'+optinId]:{v:1,max_age:maxCookieAge}});var cookieArray=[['PushBeforeSubData',JSON.stringify(pushBeforeSubData),false,false,'local'],['peclosed',false,cookieDuration,'/','cookie']];_peD.cookie.set(cookieArray);_peD.cookie.remove([['PushPersonalNotificationStatus','local'],['PushSubscriberHash','local'],['PushSubscriberID','local']]);_peD.widget.resetClosedCookie();_peD.widget.addHtml(callback);}});}
if(optinId=="3"&&peConf){var peLuncherMsg=_peD.getId('pe-optin-3-bell-launcher-message');var optin3Body=_peD.getId('pe_allow_btn_optin_'+optinId);if(optin3Body&&peLuncherMsg){optin3Body.addEventListener('mouseover',function(){_peD.showHtml(peLuncherMsg);});optin3Body.addEventListener('mouseout',function(){_peD.hideHtml(peLuncherMsg);});}}},optinData:function(callback,resubscribeData,optinId){if(_peD.userPerDenied(optinId)||!_peD.subOptinShow(optinId)){return;}
if(_peD.funExecState.optinData[optinId])return;_peD.funExecState.optinData[optinId]=true;if(_peD.optinTriggerEvent==="on_click"){return _pe.showOptin(callback,resubscribeData,4);}
var optinHtml=false,powByCss='';if(_pe.powByNot()){var powByCss='display:none';}
switch(optinId){case 1:case 7:var optinSetting=_peD.getOptinSettings(1);optinHtml=['<div id="pe_confirm_optin_1" class="pe-optin-1 pe-'+_peE.dT+' '+optinSetting.placement+'" style="background:'+optinSetting.bg+';visibility: hidden;">','<div class="pe-optin-1_imgWrapper" style="margin-right:352px"><img src="'+_peSd.site.sI+'" style="max-width:60px;max-height:60px;"></div>','<div class="pe-optin-1_titleWrapper" style="font-size:15px;font-weight:500;color:#232323">'+optinSetting.optin_title+'</div>','<div id="pe-action-btn-wrapper" class="pe-optin-1_actionbuttonWrapper" style="clear:both">','<div style="float:left;height:22px;line-height:22px;margin-top:10px;'+powByCss+'"><a href="https://www.pushengage.com" class="pe-optin-1_brandingWrapper" target="_blank">Powered by PushEngage</a></div>','<div id="pe_allow_btn_optin_1" class="pe-optin-1_allowWrapper" style="background-color:'+optinSetting.allowBtnBg+';color:#fff;">'+optinSetting.optin_allow_btn_txt+'</div>','<div id="pe_close_btn_optin_1" class="pe-optin-1_closeWrapper" style="background-color:'+optinSetting.closeBtnBg+';color:#000;margin-right:10px">'+optinSetting.optin_close_btn_txt+'</div>','</div>','</div>'].join('\n');_peD.addContent([optinHtml]);_pe.handleHtmlOptinEvent(1,resubscribeData,callback);break;case 2:var optinSetting=_peD.getOptinSettings(2);optinHtml=['<div id="pe_confirm_optin_2" class="pe-optin-2 pe-'+_peE.dT+' '+optinSetting.placement+'" style="background:'+optinSetting.bg+';visibility: hidden;">','<div class="pe-optin-2_imgWrapper"><img src="'+_peSd.site.sI+'"></div>','<div class="pe-optin-2_contentWrapper">','<div class="pe-optin-2_titleWrapper">'+optinSetting.optin_title+'</div>','<div class="pe-optin-2_actionBtnWrapper">','<div id="pe_close_btn_optin_2" class="pe-optin-2_cancelBtn" style="background-color:'+optinSetting.closeBtnBg+'">'+optinSetting.optin_close_btn_txt+'</div>','<div id="pe_allow_btn_optin_2" class="pe-optin-2_allowBtn" style="color:#fff;background-color:'+optinSetting.allowBtnBg+'">'+optinSetting.optin_allow_btn_txt+'</div>','</div>','</div>','<div class="pe-optin-2_brandingWrapper" style="'+powByCss+'"><a href="http://www.pushengage.com/" target="_blank">Powered by PushEngage</a></div>','</div>'].join('\n');_peD.addContent([optinHtml]);_pe.handleHtmlOptinEvent(2,resubscribeData,callback);break;case 3:var optinSetting=_peD.getOptinSettings(3);optinHtml=['<div id="pe_confirm_optin_3" class="pe-optin-3 pe-'+_peE.dT+' '+optinSetting.placement+'" style="background:'+optinSetting.bg+';visibility: hidden;">','<div id="pe-optin-3-bell-launcher-message" style="visibility: hidden; display: none;"><div id="pe-optin-3-mang-bell-launcher-message-body">',optinSetting.optin_title,'</div></div>','<div class="pe-optin-3_allowBtn pe-swing" id="pe_allow_btn_optin_3"><svg style="width:40px;height:40px" viewBox="0 0 24 24" id="pe-optin-3-bell-icon"> <path fill="'+optinSetting.allowBtnBg+'" d="M12,22A2,2 0 0,0 14,20H10A2,2 0 0,0 12,22M18,16V11C18,7.93 16.36,5.36 13.5,4.68V4A1.5,1.5 0 0,0 12,2.5A1.5,1.5 0 0,0 10.5,4V4.68C7.63,5.36 6,7.92 6,11V16L4,18V19H20V18L18,16Z" /> </svg></div>','</div>'].join('\n');_peD.addContent([optinHtml]);_pe.handleHtmlOptinEvent(3,resubscribeData,callback);break;case 4:var pushBeforeSubData=_peD.getJSONDataFromLStorage('PushBeforeSubData');Object.assign(pushBeforeSubData,{allow_optin_id:4});_peD.cookie.set([['PushBeforeSubData',JSON.stringify(pushBeforeSubData),false,false,'local']]);_pe.peSubscribe({resub:false},callback);break;case 6:var optinSetting=_peD.getOptinSettings(6);optinHtml=['<div id="pe_confirm_optin_6" class="pe-optin-6 pe-'+_peE.dT+' '+optinSetting.placement+'" style="background:'+optinSetting.bg+';visibility: hidden;">','<div class="pe-optin-6_contentWrapper">','<div class="pe-optin-6-titleWrapper" style="font-family:arial;font-size:17px;font-weight:500;color:#232323; line-height: 24px;">'+optinSetting.optin_title+'</div>','<img src="'+_peSd.site.sI+'" alt="site image" class="pe-optin-6_siteImg">','<div class="pe-optin-6_actionbtnWrapper">','<div class="pe-optin-6_cancelBtnWrapper">','<div id="pe_close_btn_optin_6" class="pe-optin-6_cancelBtn" style="font-size:18px;font-weight:500;color:#232323;background-color:'+optinSetting.closeBtnBg+'">'+optinSetting.optin_close_btn_txt+' </div>','</div>','<div class="pe-optin-6_allowBtnWrapper">','<div id="pe_allow_btn_optin_6" class="pe-optin-6_allowBtn" style="font-size:18px;font-weight:500;color:#fff;background-color:'+optinSetting.allowBtnBg+'">'+optinSetting.optin_allow_btn_txt+' </div>','</div>','</div>','<div class="pe-optin-6_brandingWrapper" style="'+powByCss+'"><a href="http://www.pushengage.com/" target="_blank">Powered by PushEngage</a> </div>','</div>','</div>'].join('\n');_peD.addContent([optinHtml]);_pe.handleHtmlOptinEvent(6,resubscribeData,callback);break;case 8:var optinSetting=_peD.getOptinSettings(8);var seg=["Segment1","Segment2"];try{var seg=optinSetting.optin_segments;if(typeof seg[0]=='undefined')seg[0]="Segment1";if(typeof seg[1]=='undefined')seg[1]="Segment2";var checkboxLeftCol='';var checkboxRightCol='';seg.forEach(function(segmentName,index){var newIndex=index+1;if(index%2==0){checkboxLeftCol+='<div style="display: flex; align-items: center; margin-bottom: 10px;"><span class="pe-checkbox-wrapper"><input type="checkbox" id="pe_seg'+newIndex+'_btn" value="'+segmentName+'" name="pe_seg" checked="checked"><span class="pe-checkbox-inner" style="--pe-checkbox-background-color:'+optinSetting.checkbox_bg+';--pe-checkbox-tick-color:'+optinSetting.checkbox_tick_color+';"></span></span><label for="pe_seg'+newIndex+'_btn" style="margin-right: 0px; cursor: pointer; max-width: 136px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+segmentName+'</label></div>';}else{checkboxRightCol+='<div style="display: flex; align-items: center; margin-bottom: 10px;"><span class="pe-checkbox-wrapper"><input type="checkbox" id="pe_seg'+newIndex+'_btn" value="'+segmentName+'" name="pe_seg" checked="checked"><span class="pe-checkbox-inner" style="--pe-checkbox-background-color:'+optinSetting.checkbox_bg+';--pe-checkbox-tick-color:'+optinSetting.checkbox_tick_color+';"></span></span><label for="pe_seg'+newIndex+'_btn" style="margin-right: 0px; cursor: pointer; max-width: 136px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+segmentName+'</label></div>';}});}
catch(e){console.log(e.message);}
optinHtml=['<div id="pe_confirm_optin_8" class="pe-optin-6 pe-'+_peE.dT+' '+optinSetting.placement+'" style="background:'+optinSetting.bg+';visibility: hidden;">','<div class="pe-optin-6_contentWrapper">','<img style="margin-top: 0px;" src="'+_peSd.site.sI+'" alt="site image" class="pe-optin-6_siteImg">','<div class="pe-optin-6-titleWrapper" style="font-family:arial;font-size:17px;font-weight:500;color:#232323; line-height: 24px; margin-top: 20px;">'+optinSetting.optin_title+'</div>','<div class="pe-optin-6-segmentWrapper" style="display: flex;font-family: arial;color: #232323;">','<div class="pe-optin-6-checkboxWrapper-left" style="width: 176px; padding-left: 12px;">'+checkboxLeftCol+'</div>','<div class="pe-optin-6-checkboxWrapper-right" style="width: 184px; padding-left:8px; padding-right: 12px;">'+checkboxRightCol+'</div>','</div>','<div class="pe-optin-6_actionbtnWrapper">','<div class="pe-optin-6_cancelBtnWrapper">','<div id="pe_close_btn_optin_8" class="pe-optin-6_cancelBtn" style="font-size:18px;font-weight:500;color:#232323;background-color:background-color:'+optinSetting.closeBtnBg+'">'+optinSetting.optin_close_btn_txt+' </div>','</div>','<div class="pe-optin-6_allowBtnWrapper">','<div id="pe_allow_btn_optin_8" class="pe-optin-6_allowBtn" style="font-size:18px;font-weight:500;color:#fff;background-color:'+optinSetting.allowBtnBg+'">'+optinSetting.optin_allow_btn_txt+' </div>','</div>','</div>','<div class="pe-optin-6_brandingWrapper" style="'+powByCss+'"><a href="http://www.pushengage.com/" target="_blank">Powered by PushEngage</a></div>','</div>','</div>'].join('\n');_peD.addContent([optinHtml]);_pe.handleHtmlOptinEvent(8,resubscribeData,callback);break;default:}
if(optinHtml){_peD.insertFile('css','dialog');}},subMangWidget:{isValidCustomPattern:function(customPatternAray){var status=false;var currentUrl=window.location.href;if(typeof customPatternAray!="object"){return status;}
for(i=0;i<customPatternAray.length;i++){if(typeof customPatternAray[i].rule!="string"&&customPatternAray[i].value!="string"){return status;}
if(customPatternAray[i]){switch(customPatternAray[i].rule){case'exact':if(currentUrl==customPatternAray[i].value){status=true;return status;}
break;case'contains':if(currentUrl.indexOf(customPatternAray[i].value)!==-1){status=true;return status;}
break;default:if(customPatternAray[i].value&&currentUrl.substring(0,customPatternAray[i].value.length)==customPatternAray[i].value){status=true;return status;}}}}
return status;},status:function(){var s=(_peSd.subMangWidget.status&&(_peD.deviceToken.cookie()&&_peD.cookie.get('PushSubscriberStatus')=="SUBSCRIBED"))?true:false;if(s){if(_peD.isHttpsSite()){if(Notification.permission=="granted")
s=true;else
s=false;}
else{if(_peD.cookie.get("peclosed")===""||_peD.cookie.get("peclosed")==="false"){s=false;}}}
var settings=_peSd.subMangWidget.settings;if(s&&settings.rule=="custom"){if(settings.customIncludePatterns&&settings.activeCustomPattern=="customIncludePatterns"){s=(_pe.subMangWidget.isValidCustomPattern(settings.customIncludePatterns))?true:false;}
else if(settings.customExcludePatterns&&settings.activeCustomPattern=="customExcludePatterns"){s=(_pe.subMangWidget.isValidCustomPattern(settings.customExcludePatterns))?false:true;}
else if(settings.customRule&&settings.customRuleValue){var customIncludePatterns=[{"rule":settings.customRule,"value":settings.customRuleValue}]
s=(_pe.subMangWidget.isValidCustomPattern(customIncludePatterns))?true:false;}}
return s;},addHtml:function(callback){var unsubStatus=_peD.cookie.get('PushSubscriberStatus');if(_pe.subMangWidget.status()){if(_peD.funExecState.unsubWidget)return;_peD.funExecState.unsubWidget=true;_peD.addContent([_peSd.subMangWidget.html,_peSd.subMangWidget.css]);if(_peSd.subMangWidget.settings.type=="bell"){var subMang=_peD.getId('pe-bell-sub-mang-widget'),subMangBell=_peD.getId('pe-bell-sub-mang-widget-body');function unsubCheck(e){if(unsubStatus=='UNSUBSCRIBED'){_peD.hideHtml(e);}
else{_peD.showHtml(e);}}
if(subMangBell){var unsub=_peD.getId('pe-unsubscribe-btn'),dialog=_peD.getId('pe-sub-mang-bell-dialog'),msg=_peD.getId('pe-sub-mang-bell-launcher-message'),msgBody=_peD.getId('pe-sub-mang-bell-launcher-message-body');unsubCheck(subMang);if(_peSd.subMangWidget.msg.unSubPersonalNoti){var personalNotiMangBtn=_peD.getId('pe-personal-noti-mang-btn');if(personalNotiMangBtn){personalNotiMangBtn.innerHTML=_peSd.subMangWidget.msg.unSubPersonalNotiUnsubBtnMsg;var PushPersonalReqData={status:1};if(_peD.cookie.get('PushPersonalNotificationStatus')=="false"){personalNotiMangBtn.innerHTML=_peSd.subMangWidget.msg.unSubPersonalNotiSubBtnMsg;PushPersonalReqData.status=0;}
personalNotiMangBtn.addEventListener('click',function(){_pe.personalNotificationManagement(PushPersonalReqData,function(res){if(res.statuscode==1){if(PushPersonalReqData.status==0){_peD.cookie.set([['PushPersonalNotificationStatus',true,_peD.cookie.global,'/','local']]);personalNotiMangBtn.innerHTML=_peSd.subMangWidget.msg.unSubPersonalNotiUnsubBtnMsg;PushPersonalReqData.status=1;}
else{_peD.cookie.set([['PushPersonalNotificationStatus',false,_peD.cookie.global,'/','local']]);personalNotiMangBtn.innerHTML=_peSd.subMangWidget.msg.unSubPersonalNotiSubBtnMsg;PushPersonalReqData.status=0;}}})});}}
subMangBell.addEventListener('click',function(){if(dialog){if(dialog.style.display=="block")
_peD.hideHtml(dialog);else{_peD.showHtml(dialog);_peD.hideHtml(msg);}}
unsubCheck(unsub);});subMangBell.addEventListener('mouseover',function(){if(unsubStatus=='UNSUBSCRIBED')
msgBody.innerHTML=_peSd.subMangWidget.msg.thankMsg;else
msgBody.innerHTML=_peSd.subMangWidget.msg.unsubMsg;if(dialog&&dialog.style.display!="block")
_peD.showHtml(msg);});subMangBell.addEventListener('mouseout',function(){_peD.hideHtml(msg);});if(unsub){unsub.addEventListener('click',function(){_peD.resetFunExecState();_peD.hideHtml(dialog);_pe.unsubscribe(function(res){if(res.statuscode==1){_peD.cookie.set([['PushSubscriberStatus','UNSUBSCRIBED',_peD.cookie.global,'/','cookie']]);msgBody.innerHTML=_peSd.subMangWidget.msg.thankMsg;_peD.showHtml(msg);setTimeout(function(){_peD.rvHtml(subMang);_peD.funExecState.widget=false;_peD.widget.addHtml(callback);},2000);}});});}}}
else{var subMangBtn=_peD.getId('pe-button-sub-mang-widget');if(subMangBtn){var unsub=_peD.getId('pe-unsubscribe-btn'),unsubAction=_peD.getId('pe-unsubscribe-btn-action');if(unsubStatus=='UNSUBSCRIBED'){_peD.hideHtml(subMangBtn);}
else{_peD.showHtml(unsub);}
if(unsub){unsub.addEventListener('click',function(){_peD.showHtml(unsubAction);_peD.hideHtml(unsub);});}
var unsubYes=_peD.getId('pe-unsubscribe-btn-yes');if(unsubYes){unsubYes.addEventListener('click',function(){_peD.resetFunExecState();_pe.unsubscribe(function(res){if(res.statuscode==1){_peD.cookie.set([['PushSubscriberStatus','UNSUBSCRIBED',_peD.cookie.global,'/','cookie']]);_peD.hideHtml(unsubAction);_peD.showHtml(unsub);unsub.innerHTML=_peSd.subMangWidget.msg.thankMsg;setTimeout(function(){_peD.rvHtml(subMangBtn);_peD.funExecState.widget=false;_peD.widget.addHtml(callback);},2000);}
else{_peD.showHtml(unsub);_peD.hideHtml(unsubAction);}});});}
var unsubNo=_peD.getId('pe-unsubscribe-btn-no');if(unsubNo){unsubNo.addEventListener('click',function(){_peD.hideHtml(unsubAction);_peD.showHtml(unsub);});}}}}}},optinMang:function(data){if(!data||!data.enabled){return true;}
function decodeURIComponentSafe(uri,mod){var newUri=String(uri);var out=new String(),arr,i=0,l,x;typeof mod==="undefined"?mod=0:0;arr=newUri.split(/(%(?:d0|d1)%.{2})/);for(l=arr.length;i<l;i++){try{x=decodeURIComponent(arr[i]);}catch(e){x=mod?arr[i].replace(/%(?!\d+)/g,'%25'):arr[i];}
out+=x;}
return out;}
var activeRule=data.active;var ruleValues=data[activeRule];if(activeRule&&ruleValues&&ruleValues.length){var s=false;for(i=0;i<ruleValues.length;i++){var href=window.location.href;var value=ruleValues[i].value;var rule=ruleValues[i].rule;var matchValues=[value,"http://"+value,"https://"+value,value+"/","http://"+value+"/","https://"+value+"/",encodeURI(value),decodeURIComponentSafe(value)];var hrefs=[href,encodeURI(href),decodeURIComponentSafe(href)];for(j=0;j<matchValues.length;j++){var matchValue=matchValues[j];switch(rule){case"exact":s=(matchValue==hrefs[0]||matchValue==hrefs[1]||matchValue==hrefs[2])?true:false;break;case"contains":s=(hrefs[0].indexOf(matchValue)!==-1||hrefs[1].indexOf(matchValue)!==-1||hrefs[2].indexOf(matchValue)!==-1)?true:false;break;default:s=(hrefs[0].substring(0,matchValue.length)==matchValue||hrefs[1].substring(0,matchValue.length)==matchValue||hrefs[2].substring(0,matchValue.length)==matchValue)?true:false;}
if(s)break;}
if(s)break;}
return s=(activeRule=="exclude")?!s:s;}
return true;},calScrollPer:function(callback,optinId,optinSetting){var b=document.body,dE=document.documentElement,sT=window.pageYOffset||dE.scrollTop||b.scrollTop,dH=dE.offsetHeight||b.offsetHeight,wH=window.innerHeight,sP=(dH!==wH&&dH>wH)?sT/(dH-wH):0;var p=(dH==wH||wH>dH)?optinSetting.optin_scroll:Math.round(sP*100);if(p>=optinSetting.optin_scroll-3&&p<=optinSetting.optin_scroll+3){_pe.optinData(callback,{},optinId);window.removeEventListener('scroll',function scroll(){_pe.calScrollPer(callback,optinId,optinSetting);});}},scrollEvent:function(callback,optinId,optinSetting){window.addEventListener('scroll',function scroll(){_pe.calScrollPer(callback,optinId,optinSetting);});},checkSubscriptionRules:function(callback){var willShowWidget=true;function checkRules(rule,optinId,optinSetting){willShowWidget=false;if(_pe.optinMang(rule)){_pe.isOptinRuleForCountries(rule,function(isAllow){if(!isAllow){return;}
if(!_peSd.subRule.activeType){_peSd.subRule.activeType=optinSetting.optin_category;}
switch(_peSd.subRule.activeType){case"scroll":_pe.scrollEvent(callback,optinId,optinSetting);_pe.calScrollPer(callback,optinId,optinSetting);break;default:var delay=0;if(!_peSd.subRule.isResetDelay){var Od=optinSetting.optin_delay;delay=(typeof Od=="number")?Od:(typeof Od=="string")?Number(Od):0;delay=delay*1000;}
setTimeout(function(){_pe.optinData(callback,{},optinId);},delay);}});}}
var activeOptinTypes=_peD.getActiveOptinTypes();var pushBeforeSubData=_peD.getJSONDataFromLStorage('PushBeforeSubData');activeOptinTypes.forEach(function(optinId){var optinSetting=_peD.getOptinSettings(optinId);var isExpireCookie=_peD.isExpireCookie(pushBeforeSubData['close_optin_id_'+optinId]);if(!optinSetting.popup_disabled||isExpireCookie){return;}
switch(optinId){case 1:checkRules(_peSd.optinSubscriptionRule["safari"],1,optinSetting);break;case 2:checkRules(_peSd.optinSubscriptionRule["floating_bar"],2,optinSetting);break;case 3:checkRules(_peSd.optinSubscriptionRule["bell"],3,optinSetting);break;case 4:checkRules(_peSd.optinSubscriptionRule["single_step"],4,optinSetting);break;case 6:checkRules(_peSd.optinSubscriptionRule["large_safari"],6,optinSetting);break;case 8:checkRules(_peSd.optinSubscriptionRule["large_safari_with_segment"],8,optinSetting);break;default:}});if(willShowWidget){_peD.widget.addHtml(callback);}},insertOptin:function(callback){if(_pe.optinMang(_peSd.optinMang)){_pe.isOptinRuleForCountries(_peSd.optinMang,function(isAllow){if(!isAllow){return;}
if(!_peD.userPerDenied()&&_peD.subOptinShow()){_pe.checkSubscriptionRules(callback);}
else{_peD.widget.addHtml(callback);}});}},subscribed:function(callback){_pe.subMangWidget.addHtml(callback);_pe.updateSubData();_pe.addSegmentOnPageLoad();},subscribe:function(segment,callback){if(document.readyState!="complete"&&document.readyState!="interactive"){setTimeout(function(){_pe.subscribe(segment,callback);},100);return;}
if(_peD.funExecState.subscribe)return;_peD.funExecState.subscribe=true;if(_peD.isDisableSubscriptionByUser()){return;}
var ApiNo=_pe.apiSubNotValid();if(ApiNo)return(typeof callback==='function')?callback(ApiNo):console.log(ApiNo);_peD.pvtBw(function(res){if(!res&&_peD.cookie.get('PushSubscribed')!="true"){if(typeof segment=='string'||typeof segment=='object'){_peE.subSegment=segment.toString();}
if(_peD.isHttpsSite()){if(_pe.checkSubscriptionStatus('https')){_pe.checkSubscription({type:'https'},callback,function(res){if(res.valid){_pe.subscribed(callback);}});return;}
else{_pe.insertOptin(callback);}}
else{if(_pe.checkSubscriptionStatus('http')){_pe.checkSubscription({type:'http'},callback,function(res){if(res.valid){_pe.subscribed(callback);}});return;}
else{_pe.insertOptin(callback);}}}
else{var jsonRes={statuscode:21,message:_pe.msg.error[1]};return(typeof callback==='function')?callback(jsonRes):console.log(jsonRes);}});},openDialogBox:function(segment){var optinId=_peD.subOptinType();if(!_peE.checkApiValid)return;if(_peE.sT=="http"||(_peE.sT=="https"&&_peD.swSupport(optinId)==0)){var referlink='https://'+_peSd.site.sSd+'.'+_peSd.config.domain+'?action=subscribe&optin_type=4&intermediate=true&ref_token='+_peE.refToken+'&site_type='+_peE.sT+'&widget_click='+_peE.widgetClick+'&sub_url='+_peE.subUrl;referlink=(segment&&typeof segment==='string')?referlink+'&segment='+segment:referlink;if(typeof window.open==='function')
window.open(referlink,"_blank","width=800, height=600");else
window.location=referlink;}},addSubscriberToSegment:function(segment,callback){var apiNotValid=_pe.apiNotValid();if(apiNotValid){if(typeof callback=='function'){callback(apiNotValid);}
return;}
var data={relApiPath:'/subscriber/segments/add',reqData:{segment:segment,device_token_hash:_peD.cookie.get('PushSubscriberHash')}};_peD.sendRequestToServer(data,function(res){if(typeof callback==='function'){var resObj={};try{resObj=JSON.parse(res);if(resObj.error_code===0){resObj.statuscode=1;resObj.message=_pe.msg.segAdd[0];}else{resObj.statuscode=2;resObj.message=resObj.error_message;}}catch(err){resObj.statuscode=0;resObj.message=_pe.msg.error[0];}
callback(resObj);}});},addSubscriberToDynamicSegment:function(segments,callback){var apiNotValid=_pe.apiNotValid();if(apiNotValid){if(typeof callback=='function'){callback(apiNotValid);}
return;}
var data={relApiPath:'/subscriber/dynamicSegments/add',reqData:{segments:segments,device_token_hash:_peD.cookie.get('PushSubscriberHash')}};_peD.sendRequestToServer(data,function(res){if(typeof callback==='function'){var resObj={};try{resObj=JSON.parse(res);if(resObj.error_code===0){resObj.statuscode=1;resObj.message=_pe.msg.segAdd[0];}else{resObj.statuscode=2;resObj.message=resObj.error_message;}}catch(err){resObj.statuscode=0;resObj.message=_pe.msg.error[0];}
callback(resObj);}});},removeSubscriberFromSegment:function(segment,callback){var apiNotValid=_pe.apiNotValid();if(apiNotValid){if(typeof callback=='function'){callback(apiNotValid);}
return;}
var data={relApiPath:'/subscriber/segments/remove',reqData:{segment:segment,device_token_hash:_peD.cookie.get('PushSubscriberHash')}};_peD.sendRequestToServer(data,function(res){var resObj={};try{resObj=JSON.parse(res);if(resObj.error_code===0){resObj.statuscode=1;resObj.message=_pe.msg.segRemove[0];var storageSegments;if(Array.isArray(segment)){storageSegments=segment;}
else{storageSegments=[segment];}
_pe.removeSegmentsFromStorage(storageSegments);}else{resObj.statuscode=2;resObj.message=resObj.error_message;}}catch(err){resObj.statuscode=0;resObj.message=_pe.msg.error[0];}
if(typeof callback==='function'){callback(resObj);}});},addProfileId:function(profileId,callback){var ApiNo=_pe.apiNotValid();if(typeof callback=="function"){if(ApiNo)return callback(ApiNo);if(!profileId||typeof profileId!=='string'||profileId==''||typeof profileId=="undefined")return callback({statuscode:24,message:"Your given profile id is not valid"});}
else if(ApiNo){console.log(ApiNo);return;}
var data={relApiPath:'/subscriber/profile-id/add',reqData:{profile_id:profileId,device_token_hash:_peD.cookie.get('PushSubscriberHash')}}
_peD.sendRequestToServer(data,function(res){if(typeof callback=="function"){res=JSON.parse(res);var resObj={statuscode:0,message:_pe.msg.seg[0]};switch(res.error_code){case 0:resObj.statuscode=1;resObj.message=_pe.msg.profile[0];break;case 1001:resObj.statuscode=2;resObj.message=_pe.msg.profile[1];}
return callback(resObj);}});},attributeOperationOnSubscriber:function(customAttributes,method,callback){var apiNotValid=_pe.apiNotValid();if(apiNotValid){if(typeof callback=="function"){return callback(apiNotValid);}
console.log(apiNotValid);return;}
var hash=_peD.cookie.get("PushSubscriberHash");var data={relApiPath:'/subscriber/'+hash+'/attributes',method:method,reqData:customAttributes,isSiteId:false}
_peD.sendRequestToServer(data,function(res){var resObj={};var res;try{res=JSON.parse(res);if(res.error_code===0){switch(method){case"GET":resObj.statuscode=1;resObj.message="";resObj.data=res.data;break;case"PUT":resObj.statuscode=1;resObj.message="Attribute added successfully";resObj.data=res.data;break;case"POST":resObj.statuscode=1;resObj.message="Attribute replaced successfully";resObj.data=res.data;break;case"DELETE":resObj.statuscode=1;resObj.message="Attribute removed successfully";resObj.data=res.data;break;}}else{resObj.statuscode=res.error_code;resObj.message=res.error_message;resObj.data=res.data;}}catch(err){resObj.statuscode=0;resObj.message=_pe.msg.error[0];}
if(typeof callback==="function"){return callback(resObj);}});},getTaboolaUserId:function(callback){_peD.httpRequest({query:{'app.type':'web','app.apikey':_peSd.api.taboolaApiKey,},url:_peSd.api.taboolaApi+'/json/pushengage1-new/user.sync',},function(res){if(res.status===200){var tidRes=_peD.parse(res.data);if(Object.keys(tidRes).length){return callback(tidRes.user.id);}}
return callback('');});},updateSubData:function(){var hash=_peD.cookie.get("PushSubscriberHash");_pe.subDataChange(function(changeData){if(!Object.keys(changeData.sub).length)return;var data={relApiPath:'/subscriber/'+hash,method:'PUT',reqData:changeData.sub}
_peD.sendRequestToServer(data,function(res){try{var resData=JSON.parse(res);if(resData.error_code==0){_peD.cookie.set([['PeSubData',JSON.stringify(changeData.cookie),'','/','local']]);}}
catch(e){}});});},subDataChange:function(callback){var bv=_peE.bW.version,l=navigator.language,s=screen.availWidth+'*'+screen.availHeight,ua=navigator.userAgent,cookieSubData=_peD.cookie.get('PeSubData'),tz=_peD.getTimezone(),currentTime=new Date().getTime();try{var parseCookieSubData=_peD.parse(cookieSubData),updateCookieSubData=_peD.objectAssign({},parseCookieSubData),updateSubData={};if(parseCookieSubData.bv!=bv||parseCookieSubData.l!=l||parseCookieSubData.s!=s||parseCookieSubData.tz!=tz){updateCookieSubData=_peD.objectAssign(updateCookieSubData,{bv:bv,l:l,s:s,tz:tz});updateSubData=_peD.objectAssign(updateSubData,{browser_info:{language:l,available_scr_width_height:s,user_agent:ua,},geo_info:{geobytestimezone:tz,},});}
if(_peSd.privacySettings.geoLocationEnabled&&_pe.ipDateChange(parseCookieSubData.ip)){_peD.insertFile('js','pushengage-geo',false,function(res){if(typeof peGeoInfo!="undefined"){var geoData=_peD.modifyGeo(peGeoInfo);var updateIp=geoData.geobytesipaddress;updateSubData.geo_info=geoData;updateCookieSubData.ip={v:updateIp,d:currentTime};}
if(_peSd.site.isSponsored&&_pe.taboolaIdDateChange(parseCookieSubData.tid)){_pe.getTaboolaUserId(function(tid){if(tid){updateSubData.tid=tid;updateCookieSubData.tid={v:tid,d:currentTime};return callback({sub:updateSubData,cookie:updateCookieSubData});}
callback({sub:updateSubData,cookie:updateCookieSubData});});}
else{callback({sub:updateSubData,cookie:updateCookieSubData});}});}
else if(_peSd.site.isSponsored&&_pe.taboolaIdDateChange(parseCookieSubData.tid)){_pe.getTaboolaUserId(function(tid){if(tid){updateSubData.tid=tid;updateCookieSubData.tid={v:tid,d:currentTime};return callback({sub:updateSubData,cookie:updateCookieSubData});}
callback({sub:updateSubData,cookie:updateCookieSubData});});}
else{callback({sub:updateSubData,cookie:updateCookieSubData});}}
catch(e){console.log(e.message);}},ipDateChange:function(ip){var status=true;try{if(ip){var refDate=7*24*60*60*1000,currentTime=new Date().getTime(),diffTime=currentTime-ip.d;status=(diffTime>refDate)?true:false;}}
catch(e){}
return status;},taboolaIdDateChange:function(tid){var status=true;try{if(tid){var refDate=30*24*60*60*1000,currentTime=new Date().getTime(),diffTime=currentTime-tid.d;status=(diffTime>refDate)?true:false;}}
catch(e){}
return status;},isSubscribed:function(callback,hash){if(typeof callback=="function"){callback(((!_peD.deviceToken.cookie()||_peD.cookie.get("PushSubscriberStatus")=="UNSUBSCRIBED")?false:(hash&&_peD.cookie.get("PushSubscriberHash")!="")?_peD.cookie.get("PushSubscriberHash"):true));}},checkFcmEndpoint:function(pushId){return(pushId.indexOf("fcm.googleapis.com/fcm")>-1)?true:false;},subscriberStatus:function(callback){var ApiNo=_pe.apiSubNotValid();if(typeof callback=="function"){if(ApiNo)return callback(ApiNo);var resObj={};switch(_peD.cookie.get("PushSubscriberStatus")){case'SUBSCRIBED':resObj={statuscode:1,status:'SUBSCRIBED',message:'User subscribed successfully',data:{subscriber_hash:(_peD.cookie.get("PushSubscriberHash")=='false')?'':_peD.cookie.get("PushSubscriberHash")}}
break;case'DENIED':resObj={statuscode:2,status:'DENIED',message:'User denied push notification'}
break;case'CLOSED':resObj={statuscode:3,status:'CLOSED',message:'User closed subscription Opt-in'}
break;default:resObj={statuscode:22,message:_pe.msg.error[2]}}
return callback(resObj);}},trigger:function(data){var ApiNo=_pe.apiNotValid();if(!ApiNo&&_peSd.trigger.status&&typeof data==='object'){data.device_token_hash=_peD.cookie.get('PushSubscriberHash');data.site_id=_peSd.site.sSi;var reqData={Data:data,PartitionKey:data.device_token_hash};_peD.httpRequest({method:'PUT',reqData:reqData,url:_peSd.api.triggerApi,requestHeader:[{name:'Content-type',value:'application/json'}]});}},sendEvent:function sendEvent(payload,cb){var apiNo=_pe.apiNotValid();if(apiNo||!_peSd.trigger.status){if(typeof cb==='function'){cb(apiNo);}
return;}
var reqData=payload||{};reqData.device_token_hash=_peD.cookie.get('PushSubscriberHash');var data={baseUrl:_peSd.api.eventApi,relApiPath:'/events',reqData:reqData};_peD.sendRequestToServer(data,function(res){if(typeof cb==='function'){res=JSON.parse(res);res.statuscode=0;if(res.error_code===0){res.statuscode=1;}
cb(res);}});},addAlert:function addAlert(payload,cb){var apiNo=_pe.apiNotValid();if(apiNo||!_peSd.trigger.status){if(typeof cb==='function'){cb(apiNo);}
return;}
var reqData=_peD.objectAssign({},payload);reqData.device_token_hash=_peD.cookie.get('PushSubscriberHash');var data={relApiPath:'/alerts',reqData:reqData};_peD.sendRequestToServer(data,function(res){if(typeof cb==='function'){res=JSON.parse(res);res.statuscode=0;if(res.error_code===0){res.statuscode=1;}
cb(res);}});},getAlerts:function getAlerts(filter,cb){var apiNo=_pe.apiNotValid();if(apiNo||!_peSd.trigger.status){if(typeof cb==='function'){cb(apiNo);}
return;}
var query=_peD.objectAssign({},filter);query.device_token_hash=_peD.cookie.get('PushSubscriberHash');query.site_id=_peSd.site.sSi;var data={method:"GET",relApiPath:'/alerts',reqData:{},query:query};_peD.sendRequestToServer(data,function(res){if(typeof cb==='function'){res=JSON.parse(res);res.statuscode=0;if(res.error_code==0){res.statuscode=1;}
cb(res);}});},removeAlerts:function removeAlerts(filter,cb){var apiNo=_pe.apiNotValid();if(apiNo||!_peSd.trigger.status){if(typeof cb==='function'){cb(apiNo);}
return;}
var query=_peD.objectAssign({},filter);query.device_token_hash=_peD.cookie.get('PushSubscriberHash');query.site_id=_peSd.site.sSi;var data={method:"DELETE",relApiPath:'/alerts',reqData:{},query:query};_peD.sendRequestToServer(data,function(res){if(typeof cb==='function'){res=JSON.parse(res);res.statuscode=0;if(res.error_code==0){res.statuscode=1;}
cb(res);}});},sendGoal:function sendGoal(payload,cb){var apiNo=_pe.apiNotValid();if(apiNo){if(typeof cb==='function'){cb(apiNo);}
return;}
var reqData=_peD.objectAssign({},payload);reqData.device_token_hash=_peD.cookie.get('PushSubscriberHash');var data={relApiPath:'/goals',reqData:reqData};_peD.sendRequestToServer(data,function(res){if(typeof cb==='function'){res=JSON.parse(res);res.statuscode=0;if(res.error_code==0){res.statuscode=1;}
cb(res);}});},updateSubscriber:function(status,callback){var data={relApiPath:'/subscriber/updatesubscriberstatus',reqData:{IsUnSubscribed:status,device_token_hash:_peD.cookie.get("PushSubscriberHash")}}
_peD.sendRequestToServer(data,function(res){res=JSON.parse(res);var resObj={statuscode:0};if(res.error_code==0){resObj.statuscode=1;}
return callback(resObj);});},insideUnsubscribe:function(){return new Promise(function(resolve,reject){_pe.updateSubscriber(1,function(res){return resolve(res);});});},unsubscribe:function(callback){var ApiNo=_pe.apiNotValid();if(typeof callback=="function"){if(ApiNo)return callback(ApiNo);}
else if(ApiNo){console.log(ApiNo);return;}
Promise.all([_peD.bwUnsubscribe(),_pe.insideUnsubscribe()]).then(function(res){if(res[0].statuscode==1&&res[1].statuscode==1){_peD.cookie.set([['PushSubscriberStatus','UNSUBSCRIBED',_peD.cookie.global,'/','cookie']]);if(typeof callback=="function")
return callback({statuscode:1,message:_pe.msg.success[0]});}
else{if(typeof callback=="function")
return callback({statuscode:0,message:_pe.msg.error[0]});}});},personalNotificationManagement:function(data,callback){var ApiNo=_pe.apiNotValid();if(typeof callback=="function"){if(ApiNo)return callback(ApiNo);}
else if(ApiNo){console.log(ApiNo);return;}
var reqData={relApiPath:'/subscriber/updatetriggerstatus',reqData:{triggerStatus:(data.status==1)?0:1,device_token_hash:_peD.cookie.get('PushSubscriberHash')}}
_peD.sendRequestToServer(reqData,function(res){res=JSON.parse(res);var resObj={statuscode:0,message:_pe.msg.seg[0]};if(res.error_code==0){resObj.statuscode=1;resObj.message=_pe.msg.success[1];}
return callback(resObj);});},resubscribeHttp:function(callback){_peD.resetCookie();_peE.refToken=true;_pe.insertOptin(callback);},checkSubscriptionStatus:function(type){if(type=="https"){if(Notification.permission=='granted'&&!_peD.userPerDenied())return true;}
else{if(_peE.bW.name=="Chrome"||_peE.bW.name=="Opera")return true;}
return false;},checkSubscription:function(data,callback,resCallback){if(data.type=='https'){_peD.getSubscription(function(res){if(_peE.bW.name!="Safari"){if(res.sub){try{var sub=JSON.parse(JSON.stringify(res.sub));}
catch(e){_peD.recoverSubscriber(callback);resCallback({valid:false});return;}
var pushId=_peD.cookie.get('PushSubscriberID');if(!pushId||(sub.endpoint&&sub.endpoint.indexOf(pushId)==-1)){_peD.recoverSubscriber(callback);resCallback({valid:false});}
else
resCallback({valid:true});}
else{_pe.peSubscribe({resub:true},callback);resCallback({valid:false});}}
else{var pushId=_peD.cookie.get('PushSubscriberID');if(!pushId||res.sub.deviceToken.indexOf(pushId)==-1){_peD.recoverSubscriber(callback);resCallback({valid:false});}
else
resCallback({valid:true});}});}
else{if(_peD.checkUserSubHttp()){var pushId=_peD.cookie.get('PushSubscriberID');if(_pe.checkFcmEndpoint(pushId)){resCallback({valid:true});}
else{var hash=_peD.cookie.get("PushSubscriberHash");if(hash){var data={relApiPath:'/subscriber/check/'+hash,method:'GET',reqData:{}};_peD.sendRequestToServer(data,function(res){try{res=JSON.parse(res);}
catch(e){return _pe.resubscribeHttp(callback);}
if(res.data&&res.data.gateway_endpoint){_peD.cookie.set([['PushSubscriberID',res.data.gateway_endpoint,_peD.cookie.global,'/','cookie']]);return resCallback({valid:true});}
_pe.resubscribeHttp(callback);});}
else{_pe.resubscribeHttp(callback);}}}
else{_pe.insertOptin(callback);}}},getSegmentsFromStorage:function(){var segments={};try{var subscribedSegment=_peD.cookie.get('PushSegments');if(subscribedSegment){segments=JSON.parse(subscribedSegment);}}
catch(error){console.log(error);}
return segments;},addSegmentsInStorage:function(segments){try{var subscribedSegment=_pe.getSegmentsFromStorage();var localStorageSegments=_peD.objectAssign({},subscribedSegment,segments);_peD.cookie.set([['PushSegments',JSON.stringify(localStorageSegments),_peD.cookie.global,'/','local']]);}
catch(error){console.log(error);}},removeSegmentsFromStorage:function(segments){try{var subscribedSegment=_pe.getSegmentsFromStorage();var newSegments={};for(var segmentId in subscribedSegment){var segmentName=subscribedSegment[segmentId];if(segments.indexOf(segmentName)==-1){newSegments[segmentId]=segmentName;}}
_peD.cookie.set([['PushSegments',JSON.stringify(newSegments),_peD.cookie.global,'/','local']]);}
catch(error){console.log(error);}},addSegmentOnPageLoad:function(){var addedSegmentStatus=false;try{if(!_peSd.segmentsOnPageLoad||!Array.isArray(_peSd.segmentsOnPageLoad)||!_peSd.segmentsOnPageLoad.length){return addedSegmentStatus;}
function isValidCriteria(criteriaData){var status=false;var currentUrl=window.location.href;if(typeof criteriaData!="object"){return status;}
for(var ruleName in criteriaData){var ruleData=criteriaData[ruleName];if(Array.isArray(ruleData)){switch(ruleName){case'exact':for(var i=0;i<=ruleData.length;i=i+1){var currentRule=ruleData[i];if(currentUrl==currentRule){status=true;return status;}}
break;case'contains':for(var i=0;i<=ruleData.length;i=i+1){var currentRule=ruleData[i];if(currentUrl.indexOf(currentRule)!==-1){status=true;return status;}}
break;default:for(var i=0;i<=ruleData.length;i=i+1){var currentRule=ruleData[i];if(currentRule&&currentUrl.substring(0,currentRule.length)==currentRule){status=true;return status;}}}}}
return status;}
var segments={};var segmentsData=_peSd.segmentsOnPageLoad;segmentsData.forEach(function(segment){if(typeof segment=="object"&&segment.segment_criteria){var segmentCriteria={};segmentCriteria=JSON.parse(segment.segment_criteria);if(typeof segmentCriteria!="object"){return addedSegmentStatus;}
var includeSegmentCriteriaData=segmentCriteria.include||{};var excludeSegmentCriteriaData=segmentCriteria.exclude||{};if(isValidCriteria(excludeSegmentCriteriaData)){return addedSegmentStatus;}
if(isValidCriteria(includeSegmentCriteriaData)){segments[segment.segment_id]=segment.segment_name;}}});if(Object.keys(segments).length===0){return addedSegmentStatus;}
var segmentNames=[];var subscribedSegment=_pe.getSegmentsFromStorage();for(var segmentId in segments){if(!subscribedSegment.hasOwnProperty(segmentId)){segmentNames.push(segments[segmentId]);}}
if(segmentNames.length){_pe.addSubscriberToSegment(segmentNames,function(res){if(res.statuscode==1){_pe.addSegmentsInStorage(segments);}});}
addedSegmentStatus=true;}
catch(error){console.log(error);}
return addedSegmentStatus;},optinSubscriptionTrigger:{status:function(){var status=false;if(_peSd.optinSubscriptionTrigger&&_peE.bWSupport){var optinSubscriptionTrigger=_peSd.optinSubscriptionTrigger;if(optinSubscriptionTrigger.enabled&&optinSubscriptionTrigger.selectors&&Array.isArray(optinSubscriptionTrigger.selectors)&&optinSubscriptionTrigger.selectors.length){status=true;}}
return status;},trigger:function(target){var selectors=_peSd.optinSubscriptionTrigger.selectors;for(var i=0,selectorCount=selectors.length;i<selectorCount;i+=1){try{var selector=selectors[i];var newSelector=selector.replace(/[ ]/gi,'.');if(target.closest('.'+newSelector)||target.closest('#'+newSelector)){window._peq.push(['subscribe']);break;}}
catch(e){console.log(e.message);}}}},getSubscriberData:function(queryOrCallback,callback){var query;if(typeof queryOrCallback!=="function"){query=queryOrCallback;}
var apiNotValid=_pe.apiNotValid();if(apiNotValid){if(typeof callback=='function'){callback(apiNotValid);}
return;}
var queryOptions={};if(query&&Object.keys(query).length){queryOptions=query;if(Array.isArray(query.fields)){queryOptions.fields=query.fields.toString();}};var deviceTokenHash=_peD.cookie.get('PushSubscriberHash');var data={relApiPath:'/subscriber/'+deviceTokenHash,method:'GET',isSiteId:false,query:queryOptions,};_peD.sendRequestToServer(data,function(res){if(typeof callback==='function'||typeof queryOrCallback==='function'){var resObj={};try{resObj=JSON.parse(res);if(resObj.error_code===0){resObj.statuscode=1;}else{resObj.statuscode=2;resObj.message=resObj.error_message;}}catch(err){resObj.statuscode=0;resObj.message=_pe.msg.error[0];}
callback?callback(resObj):queryOrCallback(resObj);}});},isOptinRuleForCountries:function(setting,callback){var status=true;var site=_peSd.site;if(!setting||!setting.enabled||!setting.hasOwnProperty('active_countries')||!setting.hasOwnProperty(setting.active_countries)||!Array.isArray(setting[setting.active_countries])||!setting[setting.active_countries]||!setting[setting.active_countries].length){return callback(status);}
const countries=setting[setting.active_countries];function isCountyExist(country){isExistCountry=countries.indexOf(country)>-1?true:false;return(setting.active_countries==="include_countries")?isExistCountry:!isExistCountry;}
_peD.httpRequest({url:'https://'+site.sSd+'.'+_peSd.config.domain+'/geo_data.php',},function(res){if(res.status===200){var geoData=_peD.parse(res.data);status=isCountyExist(geoData.geobytescountry);}
return callback(status);});}}
window.addEventListener('message',function(event){var validOrigin=false;_peSd.site.allowedDomain.forEach(function(e){if(e.indexOf(event.origin)!==-1||event.origin.indexOf(e)!=-1){validOrigin=true;return;}});if(validOrigin&&typeof event.data==='string'&&event.data!=''){var data={};if(event.data.indexOf('{')!==-1&&event.data.indexOf('}')!==-1){try{data=JSON.parse(event.data);}
catch(e){}}
if(typeof data.source!="undefined"){switch(data.source){case"unsubscribe":console.log(data.message);break;case"customSiteCookie":_pe.customSiteCookie.init++;if(data.PushSubscribed=="true")
_pe.customSiteCookie.set++;else
_pe.customSiteCookie.notSet++;if(_pe.customSiteCookie.init==_peD.merchantSettings.cookie().sites.length){if(_pe.customSiteCookie.set>0)
_peD.cookie.set([['PushSubscribed',true,_peD.cookie.global,'/','local']]);else
_pe._peqi.qInit();}
break;case"recoverSubscriberFromIframe":if(data.state=="notSubscribed"&&!_peD.getInputUrl('recover_subscriber_from_iframe'))
_pe._peqi.qInit();break;case"subscriptionCheck":_pe.checkSubscription(data);break;default:_peD.widget.resetClosedCookie();var optinId=_peD.subOptinType();var ce=_peE.cookie.getOptinHide(optinId),setCookie=false;var resObj={statuscode:1,message:"User subscribed successfully"};switch(data.state){case"DENIED":ce=_peD.cookie.global;setCookie=true;resObj.message="User denied push notification";resObj.statuscode=2;break;case"CLOSED":ce=_peE.cookie.getOptinHide(optinId);setCookie=true;resObj.message="User closed subscription Optin";resObj.statuscode=3;break;case"SUBSCRIBED":ce=_peD.cookie.global;setCookie=true;break;default:return;}
if(setCookie){if(ce!=0){_peD.cookie.set([['peclosed',true,ce,'/','cookie'],['PushSubscriberStatus',data.state,ce,'/','cookie']]);}
if(data.state=="SUBSCRIBED"&&data.PushSubscriberID!=''&&data.PushSubscriberHash!=''&&data.PushSubscriberID&&data.PushSubscriberHash){if(typeof data.subscriberOrigin!="undefined"&&data.subscriberOrigin=="recoverSubscriber"){_peD.cookie.set([['PushSubscribed',true,false,'/','local']]);}
resObj.subscriber_hash=data.PushSubscriberHash;resObj.data=data.geoInfoData;_peD.cookie.set([['PushSubscriberID',data.PushSubscriberID,false,'/','local'],['PushSubscriberHash',data.PushSubscriberHash,false,'/','local'],['PushPersonalNotificationStatus',true,false,'/','local'],['PeSubData',data.subCookieData,false,'/','local'],['PushSubscribeWidgetClosed',0,false,'/','local'],['PushSegments',JSON.stringify({}),false,'/','local'],]);_peD.cookie.remove([["PushSubscribeWidgetAnalytics","local"],["PushBeforeSubData","local"]])
_peD.removeOptinsHtml();_pe.subMangWidget.addHtml();}
if(typeof _pe._peqi.queue==='object'&&_pe._peqi.queue.length>0){_pe._peqi.queue.forEach(function(e,i){if(e[0]=='init'&&e.length==3){resObj.status=data.state;_pe._peqi.queue[i][2](resObj);}});}
_peD.widget.addHtml();}}}}},false);(function _peinit(){if(document.readyState!="complete"&&document.readyState!="interactive"){setTimeout(function(){_peinit();},100);return;}
if(typeof window._peq==='object'&&window._peq.length>0){_pe._peqi.queue=window._peq;_pe._peqi.init(window._peq);}
window._peq={push:function(e){_pe._peqi.init([e]);}}
if(_pe.optinSubscriptionTrigger.status()){document.addEventListener('click',function(event){_pe.optinSubscriptionTrigger.trigger(event.target)},false);}})();}
catch(e){console.log(e);}